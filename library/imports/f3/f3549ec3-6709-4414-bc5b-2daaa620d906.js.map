{"version":3,"sources":["assets\\Scripts\\UI\\BuyTipPanel.js"],"names":["Event","require","BuyTipPanel","cc","Class","Component","properties","IconSp","Sprite","nameSp","Atlas","SpriteAtlas","GoodsName","Label","BuyNumLbl","Slider","Progress","ProgressBar","InPutBox","EditBox","DesLbl","BuyNum","CanBuyNum","Data","ShowPanel","data","Math","floor","Mgr","UserDataMgr","Cash","price","WareHouseCapcity","spriteFrame","getSpriteFrame","icon","name","string","global","FormatNum","progress","OnSliderChange","OnInputBoxEnd","Number","ClickBuyBtn","AudioMgr","playSFX","CheckOwnedGoodsNum","param","forWhat","text","director","GlobalEvent","emit","OpenCommonTip","Num","Id","BuyGoods","BuySuccess","ClosePanel","node","active","module","exports"],"mappings":";;;;;;AAAA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;AAC5B,IAAIC,WAAW,GAAGC,EAAE,CAACC,KAAK,CAAC;EACvB,WAASD,EAAE,CAACE,SAAS;EAErBC,UAAU,EAAE;IACRC,MAAM,EAACJ,EAAE,CAACK,MAAM;IAChBC,MAAM,EAACN,EAAE,CAACK,MAAM;IAChBE,KAAK,EAACP,EAAE,CAACQ,WAAW;IACpBC,SAAS,EAACT,EAAE,CAACU,KAAK;IAClBC,SAAS,EAACX,EAAE,CAACU,KAAK;IAClBE,MAAM,EAACZ,EAAE,CAACY,MAAM;IAChBC,QAAQ,EAACb,EAAE,CAACc,WAAW;IACvBC,QAAQ,EAACf,EAAE,CAACgB,OAAO;IACnBC,MAAM,EAACjB,EAAE,CAACU,KAAK;IACfQ,MAAM,EAAC,CAAC;IACRC,SAAS,EAAC,CAAC;IACXC,IAAI,EAAC;EACT,CAAC;EAEDC,SAAS,EAAC,SAAAA,UAAUC,IAAI,EAAE;IACtB,IAAI,CAACF,IAAI,GAAG,IAAI;IAChB,IAAI,CAACD,SAAS,GAAGI,IAAI,CAACC,KAAK,CAAExB,EAAE,CAACyB,GAAG,CAACC,WAAW,CAACC,IAAI,GAAGL,IAAI,CAACM,KAAK,CAAC;IAClE,IAAG,IAAI,CAACT,SAAS,GAAGnB,EAAE,CAACyB,GAAG,CAACC,WAAW,CAACG,gBAAgB,EACvD;MACI,IAAI,CAACV,SAAS,GAAGnB,EAAE,CAACyB,GAAG,CAACC,WAAW,CAACG,gBAAgB;IACxD;IAEA,IAAI,CAACzB,MAAM,CAAC0B,WAAW,GAAG,IAAI,CAACvB,KAAK,CAACwB,cAAc,CAACT,IAAI,CAACU,IAAI,CAAC;IAC9D,IAAI,CAACd,MAAM,GAAG,IAAI,CAACC,SAAS;IAC5B,IAAI,CAACb,MAAM,CAACwB,WAAW,GAAG,IAAI,CAACvB,KAAK,CAACwB,cAAc,CAACT,IAAI,CAACW,IAAI,CAAC;IAC9D,IAAI,CAACtB,SAAS,CAACuB,MAAM,GAAG,IAAI,CAACf,SAAS;IACtC,IAAI,CAACJ,QAAQ,CAACmB,MAAM,GAAG,IAAI,CAACf,SAAS;IACrC,IAAI,CAACF,MAAM,CAACiB,MAAM,GAAGlC,EAAE,CAACyB,GAAG,CAACU,MAAM,CAACC,SAAS,CAAC,IAAI,CAACjB,SAAS,GAAGG,IAAI,CAACM,KAAK,CAAC;IACzE,IAAI,CAAChB,MAAM,CAACyB,QAAQ,GAAG,CAAC;IACxB,IAAI,CAACxB,QAAQ,CAACwB,QAAQ,GAAG,CAAC;IAC1B,IAAI,CAACjB,IAAI,GAAGE,IAAI;EACpB,CAAC;EAEDgB,cAAc,EAAC,SAAAA,eAAA,EAAU;IACrB,IAAI,CAACpB,MAAM,GAAGK,IAAI,CAACC,KAAK,CAAC,IAAI,CAACZ,MAAM,CAACyB,QAAQ,GAAG,IAAI,CAAClB,SAAS,CAAC;IAC/D,IAAI,CAACN,QAAQ,CAACwB,QAAQ,GAAG,IAAI,CAACzB,MAAM,CAACyB,QAAQ;IAC7C;IACA,IAAI,CAAC1B,SAAS,CAACuB,MAAM,GAAG,IAAI,CAAChB,MAAM;IACnC,IAAI,CAACH,QAAQ,CAACmB,MAAM,GAAG,IAAI,CAAChB,MAAM;IAClC,IAAI,CAACD,MAAM,CAACiB,MAAM,GAAGlC,EAAE,CAACyB,GAAG,CAACU,MAAM,CAACC,SAAS,CAAC,IAAI,CAAClB,MAAM,GAAG,IAAI,CAACE,IAAI,CAACQ,KAAK,CAAC;EAC/E,CAAC;EAEDW,aAAa,EAAC,SAAAA,cAAA,EAAU;IACvB,IAAG,IAAI,CAACxB,QAAQ,CAACmB,MAAM,IAAI,EAAE,EAC7B;MACC,IAAGM,MAAM,CAAC,IAAI,CAACzB,QAAQ,CAACmB,MAAM,CAAC,IAAI,IAAI,EACvC;QACC,IAAGM,MAAM,CAAC,IAAI,CAACzB,QAAQ,CAACmB,MAAM,CAAC,GAAG,IAAI,CAACf,SAAS,EAChD;UACC,IAAI,CAACJ,QAAQ,CAACmB,MAAM,GAAG,IAAI,CAACf,SAAS;UACrC,IAAI,CAACD,MAAM,GAAG,IAAI,CAACC,SAAS;UAC5B,IAAI,CAACN,QAAQ,CAACwB,QAAQ,GAAG,CAAC;UAC1B,IAAI,CAACzB,MAAM,CAACyB,QAAQ,GAAG,CAAC;QACzB,CAAC,MAED;UACC,IAAI,CAACnB,MAAM,GAAGsB,MAAM,CAAC,IAAI,CAACzB,QAAQ,CAACmB,MAAM,CAAC;UAC1C,IAAI,CAACtB,MAAM,CAACyB,QAAQ,GAAI,IAAI,CAACnB,MAAM,GAAG,IAAI,CAACC,SAAS;UACpD,IAAI,CAACN,QAAQ,CAACwB,QAAQ,GAAG,IAAI,CAACzB,MAAM,CAACyB,QAAQ;QAC9C;MACD;IACD,CAAC,MAED;MACC,IAAI,CAACtB,QAAQ,CAACmB,MAAM,GAAG,GAAG;MAC7B,IAAI,CAAChB,MAAM,GAAG,CAAC;MACf,IAAI,CAACL,QAAQ,CAACwB,QAAQ,GAAG,CAAC;MAC1B,IAAI,CAACzB,MAAM,CAACyB,QAAQ,GAAG,CAAC;IACtB;IACA,IAAI,CAACpB,MAAM,CAACiB,MAAM,GAAGlC,EAAE,CAACyB,GAAG,CAACU,MAAM,CAACC,SAAS,CAAC,IAAI,CAAClB,MAAM,GAAG,IAAI,CAACE,IAAI,CAACQ,KAAK,CAAC;EAC5E,CAAC;EAEDa,WAAW,EAAC,SAAAA,YAAA,EAAU;IAClB,IAAG,IAAI,CAACvB,MAAM,IAAI,CAAC,EACnB;MACIlB,EAAE,CAACyB,GAAG,CAACiB,QAAQ,CAACC,OAAO,CAAC,OAAO,CAAC;MAChC;IACJ;;IAEA;IACA,IAAG3C,EAAE,CAACyB,GAAG,CAACC,WAAW,CAACkB,kBAAkB,EAAE,IAAI,IAAI,EAClD;MACI,IAAI,CAAC3B,MAAM,CAACiB,MAAM,GAAG,YAAY;MACjC;IACJ;IAEA,IAAGlC,EAAE,CAACyB,GAAG,CAACC,WAAW,CAACG,gBAAgB,GAAG,IAAI,CAACX,MAAM,EACpD;MACI,IAAI2B,KAAK,GAAG,CAAC,CAAC;MACdA,KAAK,CAACC,OAAO,GAAG,EAAE;MAClBD,KAAK,CAACE,IAAI,GAAG,QAAQ;MACrB/C,EAAE,CAACgD,QAAQ,CAACC,WAAW,CAACC,IAAI,CAAClD,EAAE,CAACyB,GAAG,CAAC5B,KAAK,CAACsD,aAAa,EAAEN,KAAK,CAAC;MAC/D;IACJ;IACA7C,EAAE,CAACyB,GAAG,CAACC,WAAW,CAACG,gBAAgB,IAAI,IAAI,CAACX,MAAM;IAElDlB,EAAE,CAACyB,GAAG,CAACC,WAAW,CAACC,IAAI,IAAK,IAAI,CAACP,IAAI,CAACQ,KAAK,GAAG,IAAI,CAACV,MAAO;IAC1D,IAAI2B,KAAK,GAAG,CAAC,CAAC;IACdA,KAAK,CAACO,GAAG,GAAG,IAAI,CAAClC,MAAM;IACvB2B,KAAK,CAACjB,KAAK,GAAG,IAAI,CAACR,IAAI,CAACQ,KAAK;IAC7BiB,KAAK,CAACQ,EAAE,GAAG,IAAI,CAACjC,IAAI,CAACiC,EAAE;IACvB,IAAI/B,IAAI,GAAGtB,EAAE,CAACyB,GAAG,CAACC,WAAW,CAAC4B,QAAQ,CAACT,KAAK,CAAC;IAC7C;IACA7C,EAAE,CAACgD,QAAQ,CAACC,WAAW,CAACC,IAAI,CAAClD,EAAE,CAACyB,GAAG,CAAC5B,KAAK,CAAC0D,UAAU,EAAEjC,IAAI,CAAC;IAC3D,IAAI,CAACkC,UAAU,EAAE;IACjB,OAAO,IAAI,CAACpC,IAAI,CAACiC,EAAE;EACvB,CAAC;EAEDG,UAAU,EAAC,SAAAA,WAAA,EAAU;IACjBxD,EAAE,CAACyB,GAAG,CAACiB,QAAQ,CAACC,OAAO,CAAC,OAAO,CAAC;IAChC,IAAI,CAACc,IAAI,CAACC,MAAM,GAAG,KAAK;EAC5B;AAEJ,CAAC,CAAC;AACFC,MAAM,CAACC,OAAO,GAAG7D,WAAW","sourceRoot":"/","sourcesContent":["var Event = require(\"Event\");\r\nvar BuyTipPanel = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        IconSp:cc.Sprite,\r\n        nameSp:cc.Sprite,\r\n        Atlas:cc.SpriteAtlas,\r\n        GoodsName:cc.Label,\r\n        BuyNumLbl:cc.Label,\r\n        Slider:cc.Slider,\r\n        Progress:cc.ProgressBar,\r\n        InPutBox:cc.EditBox,\r\n        DesLbl:cc.Label,\r\n        BuyNum:0,\r\n        CanBuyNum:0,\r\n        Data:null,\r\n    },\r\n\r\n    ShowPanel:function (data) {\r\n        this.Data = null;\r\n        this.CanBuyNum = Math.floor( cc.Mgr.UserDataMgr.Cash / data.price);\r\n        if(this.CanBuyNum > cc.Mgr.UserDataMgr.WareHouseCapcity)\r\n        {\r\n            this.CanBuyNum = cc.Mgr.UserDataMgr.WareHouseCapcity;\r\n        }\r\n\r\n        this.IconSp.spriteFrame = this.Atlas.getSpriteFrame(data.icon);\r\n        this.BuyNum = this.CanBuyNum;\r\n        this.nameSp.spriteFrame = this.Atlas.getSpriteFrame(data.name);\r\n        this.BuyNumLbl.string = this.CanBuyNum;\r\n        this.InPutBox.string = this.CanBuyNum;\r\n        this.DesLbl.string = cc.Mgr.global.FormatNum(this.CanBuyNum * data.price); \r\n        this.Slider.progress = 1;\r\n        this.Progress.progress = 1;\r\n        this.Data = data;\r\n    },\r\n\r\n    OnSliderChange:function(){\r\n        this.BuyNum = Math.floor(this.Slider.progress * this.CanBuyNum);\r\n        this.Progress.progress = this.Slider.progress;\r\n        ////cc.log(\"+++++++++++++++++++++\" + this.price);\r\n        this.BuyNumLbl.string = this.BuyNum;\r\n        this.InPutBox.string = this.BuyNum\r\n        this.DesLbl.string = cc.Mgr.global.FormatNum(this.BuyNum * this.Data.price);\r\n    },\r\n\r\n    OnInputBoxEnd:function(){\r\n    \tif(this.InPutBox.string != \"\")\r\n    \t{\r\n    \t\tif(Number(this.InPutBox.string) != null)\r\n    \t\t{\r\n    \t\t\tif(Number(this.InPutBox.string) > this.CanBuyNum) \r\n    \t\t\t{\r\n    \t\t\t\tthis.InPutBox.string = this.CanBuyNum;\r\n    \t\t\t\tthis.BuyNum = this.CanBuyNum;\r\n    \t\t\t\tthis.Progress.progress = 1;\r\n    \t\t\t\tthis.Slider.progress = 1;\r\n    \t\t\t}\r\n    \t\t\telse\r\n    \t\t\t{\r\n    \t\t\t\tthis.BuyNum = Number(this.InPutBox.string);\r\n    \t\t\t\tthis.Slider.progress =  this.BuyNum / this.CanBuyNum;\r\n    \t\t\t\tthis.Progress.progress = this.Slider.progress;\r\n    \t\t\t}\r\n    \t\t}\r\n    \t}\r\n    \telse\r\n    \t{\r\n    \t\tthis.InPutBox.string = \"0\";\r\n\t\t\tthis.BuyNum = 0;\r\n\t\t\tthis.Progress.progress = 0;\r\n\t\t\tthis.Slider.progress = 0;\r\n    \t}\r\n    \tthis.DesLbl.string = cc.Mgr.global.FormatNum(this.BuyNum * this.Data.price);\r\n    },\r\n\r\n    ClickBuyBtn:function(){\r\n        if(this.BuyNum <= 0)\r\n        {\r\n            cc.Mgr.AudioMgr.playSFX(\"click\");\r\n            return;\r\n        }\r\n\r\n        //判断是否已经买了物种物品\r\n        if(cc.Mgr.UserDataMgr.CheckOwnedGoodsNum() == true)\r\n        {\r\n            this.DesLbl.string = \"只能购买拥有5种物品\";\r\n            return;\r\n        }\r\n        \r\n        if(cc.Mgr.UserDataMgr.WareHouseCapcity < this.BuyNum)\r\n        {\r\n            var param = {};\r\n            param.forWhat = \"\";\r\n            param.text = \"仓库容量不够\";\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);\r\n            return ;\r\n        }\r\n        cc.Mgr.UserDataMgr.WareHouseCapcity -= this.BuyNum;\r\n\r\n        cc.Mgr.UserDataMgr.Cash -= (this.Data.price * this.BuyNum);\r\n        var param = {};\r\n        param.Num = this.BuyNum;\r\n        param.price = this.Data.price;\r\n        param.Id = this.Data.Id;\r\n        var data = cc.Mgr.UserDataMgr.BuyGoods(param);\r\n        //通知刷新现金\r\n        cc.director.GlobalEvent.emit(cc.Mgr.Event.BuySuccess, data);\r\n        this.ClosePanel();\r\n        return this.Data.Id;\r\n    },\r\n\r\n    ClosePanel:function(){\r\n        cc.Mgr.AudioMgr.playSFX(\"click\");\r\n        this.node.active = false;\r\n    },\r\n\r\n});\r\nmodule.exports = BuyTipPanel;\r\n"]}