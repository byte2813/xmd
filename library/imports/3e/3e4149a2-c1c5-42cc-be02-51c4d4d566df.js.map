{"version":3,"sources":["assets\\Scripts\\UI\\BetPanel.js"],"names":["TempBonus","require","BetPanel","cc","Class","Component","properties","Atlas","SpriteAtlas","CashLbl","Label","costLbl","cost","Integer","CoinNode","Node","CoinEffect","Animation","zhenNode","stateBet","rate","IsWin","tmpWinRatio","ShowPanel","data","active","rotation","string","Mgr","global","BetInitCost","UserDataMgr","Cash","ClickBet","AudioMgr","playSFX","param","forWhat","text","getTranslation","director","GlobalEvent","emit","Event","OpenCommonTip","GoToBet","CaculateWinRatio","seed","Math","random","rotateAngle","BetWinNullRatio","sd","BetWinThreeRatio","BetWinFourRatio","_this","self","floor","x","rotateTo","easing","easeSineInOut","finished","callFunc","log","EndBet","action","sequence","runAction","ShowResult","getMoney","TempAdsBetBonus","BetBonus","RefreshCashAsset","play","EndCoinEffect","ClosePanel","node","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var TempBonus = require(\"TempBonus\");\r\nvar BetPanel = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       Atlas:cc.SpriteAtlas,\r\n       CashLbl:cc.Label,\r\n       costLbl:cc.Label,\r\n       cost:cc.Integer,\r\n\r\n       CoinNode:cc.Node,\r\n       CoinEffect:cc.Animation,\r\n\r\n  \t   zhenNode:cc.Node,\r\n       stateBet:false,\r\n       rate:0,\r\n       IsWin:false,\r\n       tmpWinRatio:0,//临时赢钱概率\r\n    },\r\n\r\n    ShowPanel:function (data) {\r\n    \tthis.CoinNode.active = false;\r\n    \tthis.stateBet = false;\r\n        this.tmpWinRatio = 0;\r\n        this.zhenNode.rotation = 0;\r\n        this.costLbl.string = \"花费金额:\"+cc.Mgr.global.BetInitCost;\r\n        this.CashLbl.string = cc.Mgr.UserDataMgr.Cash;\r\n    },\r\n\r\n    ClickBet:function(){\r\n        cc.Mgr.AudioMgr.playSFX(\"click\");\r\n        if(this.stateBet == true)\r\n            return\r\n\r\n        if(cc.Mgr.UserDataMgr.Cash < cc.Mgr.global.BetInitCost)\r\n        {\r\n            var param = {};\r\n            param.forWhat = \"\";\r\n            param.text = cc.Mgr.global.getTranslation(\"MoneyNotEnough\");\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);\r\n            return;\r\n        }\r\n        this.stateBet = true;\r\n        this.GoToBet();\r\n    },\r\n\r\n    CaculateWinRatio:function(){\r\n        var seed = Math.random();\r\n        this.IsWin = true;\r\n        (this.zhenNode.rotation / 60) % 6;\r\n        var rotateAngle = 360 * 6;\r\n        if(seed < cc.Mgr.global.BetWinNullRatio)\r\n        {\r\n            this.IsWin = false;\r\n            this.rate = 0;\r\n            var sd = Math.random();\r\n            if(sd < 0.33)\r\n                rotateAngle += 0;\r\n            else if(sd < 0.66)\r\n                rotateAngle += 2 * 60;\r\n            else\r\n                rotateAngle += 4 * 60;\r\n        }\r\n        else if(seed < cc.Mgr.global.BetWinThreeRatio)\r\n        {\r\n            this.rate = 3;\r\n            rotateAngle += 1 * 60;\r\n        }\r\n        else if(seed < cc.Mgr.global.BetWinFourRatio)\r\n        {\r\n            this.rate = 4;\r\n            rotateAngle += 3 * 60;\r\n        }\r\n        else\r\n        {\r\n            this.rate = 5;\r\n            rotateAngle += 5 * 60;\r\n        }\r\n        return rotateAngle;\r\n    },\r\n\r\n    //0 2 4 位置是 谢谢惠顾\r\n    //1 3 5 是win\r\n    GoToBet:function(){\r\n    \tvar self = this;\r\n    \tvar seed = Math.floor(Math.random() * 6) + 1;\r\n\r\n        cc.Mgr.UserDataMgr.Cash -= cc.Mgr.global.BetInitCost;\r\n\r\n    \tvar x = this.CaculateWinRatio();\r\n    \tvar rotation = cc.rotateTo(3, x).easing(cc.easeSineInOut());\r\n    \tvar finished = cc.callFunc(()=>{\r\n    \t\tcc.log(\"这就是结局================\" + this.zhenNode.rotation);\r\n    \t\tself.EndBet();\r\n    \t},this);\r\n\r\n    \tvar action = cc.sequence(rotation, finished);\r\n    \tthis.zhenNode.runAction(action);\r\n    },\r\n\r\n    ShowResult:function(){\r\n        if(this.IsWin)\r\n        {\r\n            var param = {};\r\n            var getMoney = (cc.Mgr.global.BetInitCost * this.rate); \r\n            if(cc.Mgr.global.TempAdsBetBonus == TempBonus.BetBonus)\r\n            {\r\n                getMoney = Math.floor(cc.Mgr.global.BetInitCost * this.rate * 1.2);\r\n                //cc.Mgr.global.TempAdsBetBonus = TempBonus.NULL;\r\n            }\r\n            cc.Mgr.UserDataMgr.Cash += getMoney;\r\n            param.text = cc.Mgr.global.getTranslation(\"BetWin\")+ \"\\n奖励:\" + getMoney;\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);\r\n            this.tmpWinRatio = 0;//临时概率清零\r\n        }\r\n        else\r\n        {\r\n            var param = {};\r\n            param.text = cc.Mgr.global.getTranslation(\"BetLose\");\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);\r\n            this.tmpWinRatio += 0.05;\r\n            if(this.tmpWinRatio > 0.25)\r\n            {\r\n                this.tmpWinRatio = 0.25;\r\n            }\r\n        }\r\n        cc.Mgr.global.BetInitCost = cc.Mgr.global.BetInitCost * 2;\r\n        cc.director.GlobalEvent.emit(cc.Mgr.Event.RefreshCashAsset, {});\r\n        this.costLbl.string = \"花费金额:\"+cc.Mgr.global.BetInitCost;\r\n        this.CashLbl.string = cc.Mgr.UserDataMgr.Cash;\r\n    },\r\n\r\n    EndBet:function(){\r\n        if(this.IsWin)\r\n        {\r\n        \tthis.CoinNode.active = true;\r\n            this.CoinEffect.play(\"betCoin\");\r\n            cc.Mgr.AudioMgr.playSFX(\"goods_4\");\r\n        }\r\n        else\r\n        {\r\n        \tthis.stateBet = false;\r\n            cc.Mgr.AudioMgr.playSFX(\"lose\");\r\n            this.ShowResult();\r\n        }\r\n    },\r\n\r\n    EndCoinEffect:function(){\r\n    \tthis.CoinNode.active = false;\r\n    \tthis.stateBet = false;\r\n        this.ShowResult();\r\n    },\r\n\r\n    ClosePanel:function(){\r\n        cc.Mgr.AudioMgr.playSFX(\"click\");\r\n        this.node.active = false;\r\n    }, \r\n});\r\nmodule.exports = BetPanel;\r\n"]}