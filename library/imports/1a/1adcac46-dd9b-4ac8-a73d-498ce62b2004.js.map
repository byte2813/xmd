{"version":3,"sources":["assets\\Scripts\\UI\\OwnItem.js"],"names":["Event","require","UserState","ItemType","OwnItem","cc","Class","Component","properties","Atlas","SpriteAtlas","udAtlas","IconSp","Sprite","stateSp","NameLbl","PriceLbl","Label","NumLbl","Id","Integer","buyPrice","Data","init","data","spriteFrame","getSpriteFrame","icon","name","string","ownNum","toString","refreshData","node","active","RefreshState","Mgr","UserDataMgr","getDataByItemTypeAndId","Goods","marketPrice","flag","CheckIdIsInShowList","OpenSaleTipPanel","AudioMgr","playSFX","userState","NotOK","param","text","global","getTranslation","director","GlobalEvent","emit","OpenCommonTip","OpenSaleTip","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Event = require(\"Event\");\r\nvar UserState = require(\"UserState\");\r\nvar ItemType = require(\"ItemType\");\r\nvar OwnItem = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Atlas:cc.SpriteAtlas,\r\n        udAtlas:cc.SpriteAtlas,\r\n        IconSp:cc.Sprite,\r\n        stateSp:cc.Sprite,\r\n        NameLbl:cc.Sprite,\r\n        PriceLbl:cc.Label,\r\n        NumLbl:cc.Label,\r\n        Id:cc.Integer,\r\n        buyPrice:cc.Integer,\r\n        Data:null,\r\n    },\r\n    \r\n    init:function (data) {\r\n        this.Id = data.Id;\r\n        this.Data = data;\r\n        this.buyPrice = data.buyPrice;\r\n        this.IconSp.spriteFrame = this.Atlas.getSpriteFrame(data.icon);\r\n        this.NameLbl.spriteFrame = this.Atlas.getSpriteFrame(data.name);\r\n        this.NumLbl.string = data.ownNum.toString();\r\n        this.PriceLbl.string = data.buyPrice.toString();\r\n    },\r\n\r\n    refreshData:function(data){\r\n        this.PriceLbl.string = data.buyPrice.toString();\r\n        this.NumLbl.string = data.ownNum.toString();\r\n        this.buyPrice = data.buyPrice;\r\n        this.stateSp.node.active = false;\r\n    },\r\n\r\n    RefreshState:function(){\r\n        var data = cc.Mgr.UserDataMgr.getDataByItemTypeAndId(ItemType.Goods, this.Id);\r\n        var marketPrice = data.marketPrice;\r\n        var ownNum = data.ownNum;\r\n        var flag = cc.Mgr.UserDataMgr.CheckIdIsInShowList(this.Id);\r\n        if(data != null && ownNum > 0 && flag == true)\r\n        {\r\n            this.stateSp.node.active = true;\r\n            if(marketPrice > this.buyPrice)\r\n            {\r\n                this.stateSp.spriteFrame = this.udAtlas.getSpriteFrame(\"up\");\r\n            }\r\n            else if(marketPrice < this.buyPrice)\r\n            {\r\n                this.stateSp.spriteFrame = this.udAtlas.getSpriteFrame(\"down\");\r\n            }\r\n            else\r\n            {\r\n                this.stateSp.node.active = false;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.stateSp.node.active = false;\r\n        }\r\n    },\r\n\r\n    OpenSaleTipPanel:function(){\r\n        cc.Mgr.AudioMgr.playSFX(\"goods_\" + this.Id);\r\n        if(cc.Mgr.UserDataMgr.userState == UserState.NotOK)\r\n        {\r\n            var param = {};\r\n            param.text = cc.Mgr.global.getTranslation(\"InHealDownLine\");\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);\r\n            return;\r\n        }\r\n\r\n        var flag = cc.Mgr.UserDataMgr.CheckIdIsInShowList(this.Data.Id);\r\n        if(flag == true)\r\n        {  \r\n            //cc.log(\"准备出售东西 = \" + this.Data.name);\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenSaleTip, this.Data);\r\n        }\r\n        else\r\n        {\r\n            var param = {};\r\n            param.text = cc.Mgr.global.getTranslation(\"goods_\"+this.Data.Id)+ \"沒有市場需求\";\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);\r\n            //cc.log(\"當前該物品不參與交易\");\r\n        }\r\n    },\r\n});\r\nmodule.exports = OwnItem;"]}