{"version":3,"sources":["assets\\Scripts\\UI\\SaleTipPanel.js"],"names":["Event","require","AdsParam","TempBonus","SaleTipPanel","cc","Class","Component","properties","IconSp","Sprite","nameSp","Atlas","SpriteAtlas","GoodsName","Label","SaleNumLbl","EarnLbl","CBLbl","Slider","InPutBox","EditBox","Progress","ProgressBar","SaleNum","Data","needDouble","ShowPanel","data","ownNum","spriteFrame","getSpriteFrame","icon","name","marketPrice","Mgr","UserDataMgr","getGoodsDataById","Id","money","buyPrice","chengben","global","TempAdsAssetBonus","AssetBonus","Math","floor","string","FormatNum","progress","OnSliderChange","OnInputBoxEnd","Number","showRewardVideo","js2android","console","log","window","injectedObject","setJsContent","ClickSaleBtn","AudioMgr","playSFX","WareHouseCapcity","getMoney","Cash","param","Num","price","SaleGoods","Reputation","director","GlobalEvent","emit","SaleSuccess","ClosePanel","node","active","DoubleGetByVedio","self","AdsMgr","ShowVideoAds","PointC","out","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Event = require(\"Event\");\r\nvar AdsParam = require(\"AdsParam\");\r\nvar TempBonus = require(\"TempBonus\");\r\nvar SaleTipPanel = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        IconSp:cc.Sprite,\r\n        nameSp:cc.Sprite,\r\n        Atlas:cc.SpriteAtlas,\r\n        GoodsName:cc.Label,\r\n        SaleNumLbl:cc.Label,\r\n        EarnLbl:cc.Label,\r\n        CBLbl:cc.Label,\r\n        Slider:cc.Slider,\r\n        InPutBox:cc.EditBox,\r\n        Progress:cc.ProgressBar,\r\n        SaleNum:0,\r\n        Data:null,\r\n\r\n        needDouble:1,//是否收益翻倍\r\n    },\r\n\r\n    ShowPanel:function (data) {\r\n        this.needDouble = 1;\r\n        this.Data = null;\r\n        this.SaleNum = data.ownNum;\r\n        this.IconSp.spriteFrame = this.Atlas.getSpriteFrame(data.icon);\r\n        this.nameSp.spriteFrame = this.Atlas.getSpriteFrame(data.name);\r\n        var marketPrice = cc.Mgr.UserDataMgr.getGoodsDataById(data.Id).marketPrice;\r\n        var money = data.ownNum * (marketPrice - data.buyPrice);\r\n        var chengben = data.ownNum * marketPrice;\r\n        if(cc.Mgr.global.TempAdsAssetBonus == TempBonus.AssetBonus)\r\n        {\r\n            if(money > 0)\r\n                money = Math.floor(money * 1.2); //有之前看过广告\r\n        }\r\n        this.EarnLbl.string = cc.Mgr.global.FormatNum(money);\r\n        this.CBLbl.string = cc.Mgr.global.FormatNum(chengben);\r\n        this.SaleNumLbl.string = data.ownNum;\r\n        this.InPutBox.string = data.ownNum;\r\n        this.Slider.progress = 1;\r\n        this.Progress.progress = 1;\r\n        this.Data = data;\r\n    },\r\n\r\n    OnSliderChange:function(){\r\n        this.SaleNum = Math.floor(this.Slider.progress * this.Data.ownNum);\r\n        this.Progress.progress = this.Slider.progress;\r\n        var marketPrice = cc.Mgr.UserDataMgr.getGoodsDataById(this.Data.Id).marketPrice;\r\n        var money = this.SaleNum * (marketPrice - this.Data.buyPrice);\r\n\r\n        var chengben = this.SaleNum * marketPrice;\r\n        this.CBLbl.string = cc.Mgr.global.FormatNum(chengben);\r\n\r\n        this.InPutBox.string = this.SaleNum;\r\n        if(cc.Mgr.global.TempAdsAssetBonus == TempBonus.AssetBonus)\r\n        {\r\n            if(money > 0)\r\n                money = Math.floor(money *1.2); //有之前看过广告\r\n        }\r\n        this.EarnLbl.string = cc.Mgr.global.FormatNum(money);\r\n        this.SaleNumLbl.string = this.SaleNum;\r\n    },\r\n\r\n    OnInputBoxEnd:function(){\r\n        if(this.InPutBox.string != \"\")\r\n        {\r\n            if(Number(this.InPutBox.string) != null)\r\n            {\r\n                if(Number(this.InPutBox.string) > this.Data.ownNum) \r\n                {\r\n                    this.InPutBox.string = this.Data.ownNum;\r\n                    this.SaleNum = this.Data.ownNum;\r\n                    this.Progress.progress = 1;\r\n                    this.Slider.progress = 1;\r\n                }\r\n                else\r\n                {\r\n                    this.SaleNum = Number(this.InPutBox.string);\r\n                    this.Slider.progress =  this.SaleNum / this.Data.ownNum;\r\n                    this.Progress.progress = this.Slider.progress;\r\n                }\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.InPutBox.string = \"0\";\r\n            this.SaleNum = 0;\r\n            this.Progress.progress = 0;\r\n            this.Slider.progress = 0;\r\n        }\r\n        var marketPrice = cc.Mgr.UserDataMgr.getGoodsDataById(this.Data.Id).marketPrice;\r\n        var money = this.SaleNum * (marketPrice - this.Data.buyPrice);\r\n\r\n        var chengben = this.SaleNum * marketPrice;\r\n        this.CBLbl.string = cc.Mgr.global.FormatNum(chengben);\r\n\r\n        if(cc.Mgr.global.TempAdsAssetBonus == TempBonus.AssetBonus)\r\n        {\r\n            if(money > 0)\r\n                money = Math.floor(money *1.2); //有之前看过广告\r\n        }\r\n        this.EarnLbl.string = cc.Mgr.global.FormatNum(money);\r\n    },\r\n    showRewardVideo() {\r\n        this.js2android('show_reward_video', '1')\r\n    },\r\n\r\n    ///激励视频播放完成回调方法 continue_game\r\n    /// Native.android2js(\"continue_game\", ()=>{\r\n    ///     //激励视频播放完成，原生端回调\r\n    /// });\r\n    js2android(name, data){\r\n        console.log(`name:${name}-data:${data}`);\r\n        if(window.injectedObject && window.injectedObject.setJsContent){\r\n            window.injectedObject.setJsContent(name, data);\r\n        }\r\n    },\r\n    ClickSaleBtn:function(){\r\n        if(this.SaleNum <= 0)\r\n        {\r\n            cc.Mgr.AudioMgr.playSFX(\"click\");\r\n            return;\r\n        }\r\n        \r\n        cc.Mgr.UserDataMgr.WareHouseCapcity += this.SaleNum;\r\n\r\n        var marketPrice = cc.Mgr.UserDataMgr.getGoodsDataById(this.Data.Id).marketPrice;\r\n        var getMoney = (marketPrice * this.SaleNum);\r\n        if(cc.Mgr.global.TempAdsAssetBonus == TempBonus.AssetBonus)\r\n        {\r\n            var money = this.SaleNum * (marketPrice - this.Data.buyPrice);\r\n            if(money > 0)\r\n                getMoney = Math.floor(getMoney * 1.2) * this.needDouble;\r\n            //cc.Mgr.global.TempAdsBonus = TempBonus.NULL;\r\n        }\r\n        cc.Mgr.UserDataMgr.Cash += getMoney;\r\n        var param = {};\r\n        param.Num = this.SaleNum;\r\n        param.price = this.Data.buyPrice;\r\n        param.Id = this.Data.Id;\r\n        var data = cc.Mgr.UserDataMgr.SaleGoods(param);\r\n        if(marketPrice > this.Data.buyPrice)\r\n            cc.Mgr.UserDataMgr.Reputation += 2;\r\n        //通知刷新现金\r\n        cc.director.GlobalEvent.emit(cc.Mgr.Event.SaleSuccess, data);\r\n        this.ClosePanel();\r\n    },\r\n\r\n    ClosePanel:function(){\r\n        cc.Mgr.AudioMgr.playSFX(\"click\");\r\n        this.node.active = false;\r\n    },\r\n\r\n    DoubleGetByVedio:function(){\r\n        if(this.SaleNum <= 0)\r\n        {\r\n            cc.Mgr.AudioMgr.playSFX(\"click\");\r\n            return;\r\n        }\r\n        var self = this;\r\n        self.showRewardVideo()\r\n        cc.Mgr.AdsMgr.ShowVideoAds(AdsParam.PointC, function(out){\r\n            \r\n            if(out == 0)\r\n            {\r\n                self.needDouble = 2;\r\n                self.ClickSaleBtn();\r\n            }\r\n        });\r\n    },\r\n\r\n});\r\nmodule.exports = SaleTipPanel;\r\n"]}