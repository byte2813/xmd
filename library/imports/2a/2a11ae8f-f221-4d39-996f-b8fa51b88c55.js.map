{"version":3,"sources":["assets\\Scripts\\UI\\GoodsItem.js"],"names":["Event","require","UserState","GoodsItem","cc","Class","Component","properties","Atlas","SpriteAtlas","IconSp","Sprite","NameLbl","PriceLbl","Label","State","Id","Integer","price","Data","init","data","spriteFrame","getSpriteFrame","icon","name","priceId","refreshPrice","refreshLowPrice","priceList","lowprice","d","Math","random","highprice","floor","Mgr","UserDataMgr","RefreshGoodsMarKetPrice","string","toString","param","refreshMidPrice","refreshUpPrice","change","seed","probability","OpenBuyTipPanel","AudioMgr","playSFX","userState","NotOK","text","director","GlobalEvent","emit","OpenCommonTip","OpenBuyTip","module","exports"],"mappings":";;;;;;AAAA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;AAC5B,IAAIC,SAAS,GAAGD,OAAO,CAAC,WAAW,CAAC;AACpC,IAAIE,SAAS,GAAGC,EAAE,CAACC,KAAK,CAAC;EACrB,WAASD,EAAE,CAACE,SAAS;EAErBC,UAAU,EAAE;IACR;IACAC,KAAK,EAACJ,EAAE,CAACK,WAAW;IACpBC,MAAM,EAACN,EAAE,CAACO,MAAM;IAChBC,OAAO,EAACR,EAAE,CAACO,MAAM;IACjBE,QAAQ,EAACT,EAAE,CAACU,KAAK;IACjBC,KAAK,EAAC,CAAC;IAAE;IACT;IACAC,EAAE,EAACZ,EAAE,CAACa,OAAO;IACbC,KAAK,EAACd,EAAE,CAACa,OAAO;IAChBE,IAAI,EAAC;EACT,CAAC;EAEDC,IAAI,EAAC,SAAAA,KAAUC,IAAI,EAAE;IACjB,IAAI,CAACF,IAAI,GAAGE,IAAI;IAChB,IAAI,CAACL,EAAE,GAAGK,IAAI,CAACL,EAAE;IACjB,IAAI,CAACN,MAAM,CAACY,WAAW,GAAG,IAAI,CAACd,KAAK,CAACe,cAAc,CAACF,IAAI,CAACG,IAAI,CAAC;IAC9D,IAAI,CAACZ,OAAO,CAACU,WAAW,GAAG,IAAI,CAACd,KAAK,CAACe,cAAc,CAACF,IAAI,CAACI,IAAI,CAAC;IAC/D,IAAI,CAACC,OAAO,GAAG,CAAC,CAAC,CAAC;IAClB,IAAI,CAACC,YAAY,EAAE;EACvB,CAAC;EAEDC,eAAe,EAAC,SAAAA,gBAAA,EAAU;IACtB,IAAIC,SAAS,GAAG,IAAI,CAACV,IAAI,CAACU,SAAS;IACnC,IAAIX,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ;IACjC,IAAI,CAACJ,OAAO,GAAG,CAAC;IAChB,IAAIK,CAAC,GAAGC,IAAI,CAACC,MAAM,EAAE;IACrBf,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,GAAGC,CAAC,IAAEF,SAAS,CAAC,CAAC,CAAC,CAACK,SAAS,GAAGL,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC;IAClF,IAAI,CAACZ,KAAK,GAAGc,IAAI,CAACG,KAAK,CAACjB,KAAK,CAAC;IAC9B,IAAI,CAACC,IAAI,CAACD,KAAK,GAAG,IAAI,CAACA,KAAK;IAC5Bd,EAAE,CAACgC,GAAG,CAACC,WAAW,CAACC,uBAAuB,CAAC,IAAI,CAACtB,EAAE,EAAE,IAAI,CAACE,KAAK,CAAC;IAC/D,IAAI,CAACL,QAAQ,CAAC0B,MAAM,GAAG,IAAI,CAACrB,KAAK,CAACsB,QAAQ,EAAE;IAC5C,IAAIC,KAAK,GAAG,CAAC,CAAC;IACd,IAAI,CAAC1B,KAAK,GAAG,CAAC;IACd0B,KAAK,CAAC1B,KAAK,GAAG,CAAC,CAAC,CAAC;IACjB0B,KAAK,CAACzB,EAAE,GAAG,IAAI,CAACA,EAAE;IAClByB,KAAK,CAACjB,IAAI,GAAG,IAAI,CAACL,IAAI,CAACK,IAAI;IAC3BiB,KAAK,CAAChB,IAAI,GAAG,IAAI,CAACN,IAAI,CAACM,IAAI;IAC3BgB,KAAK,CAACvB,KAAK,GAAG,IAAI,CAACA,KAAK;IACxB,OAAOuB,KAAK;EAChB,CAAC;EAEDC,eAAe,EAAC,SAAAA,gBAAA,EAAU;IACtB,IAAIb,SAAS,GAAG,IAAI,CAACV,IAAI,CAACU,SAAS;IACnC,IAAIX,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ;IACjC,IAAI,CAACJ,OAAO,GAAG,CAAC;IAChB,IAAIK,CAAC,GAAGC,IAAI,CAACC,MAAM,EAAE;IACrBf,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,GAAGC,CAAC,IAAEF,SAAS,CAAC,CAAC,CAAC,CAACK,SAAS,GAAGL,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC;IAClF,IAAI,CAACZ,KAAK,GAAGc,IAAI,CAACG,KAAK,CAACjB,KAAK,CAAC;IAC9B,IAAI,CAACC,IAAI,CAACD,KAAK,GAAG,IAAI,CAACA,KAAK;IAC5Bd,EAAE,CAACgC,GAAG,CAACC,WAAW,CAACC,uBAAuB,CAAC,IAAI,CAACtB,EAAE,EAAE,IAAI,CAACE,KAAK,CAAC;IAC/D,IAAI,CAACL,QAAQ,CAAC0B,MAAM,GAAG,IAAI,CAACrB,KAAK,CAACsB,QAAQ,EAAE;IAC5C,IAAIC,KAAK,GAAG,CAAC,CAAC;IACd,IAAI,CAAC1B,KAAK,GAAG,CAAC;IACd0B,KAAK,CAAC1B,KAAK,GAAG,CAAC,CAAC,CAAC;IACjB0B,KAAK,CAACzB,EAAE,GAAG,IAAI,CAACA,EAAE;IAClByB,KAAK,CAACjB,IAAI,GAAG,IAAI,CAACL,IAAI,CAACK,IAAI;IAC3BiB,KAAK,CAAChB,IAAI,GAAG,IAAI,CAACN,IAAI,CAACM,IAAI;IAC3BgB,KAAK,CAACvB,KAAK,GAAG,IAAI,CAACA,KAAK;IACxB,OAAOuB,KAAK;EAChB,CAAC;EAEDE,cAAc,EAAC,SAAAA,eAAA,EAAU;IACrB,IAAId,SAAS,GAAG,IAAI,CAACV,IAAI,CAACU,SAAS;IACnC,IAAIX,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ;IACjC;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQ,IAAI,CAACJ,OAAO,GAAG,CAAC;IAChB,IAAIK,CAAC,GAAGC,IAAI,CAACC,MAAM,EAAE;IACrBf,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,GAAGC,CAAC,IAAEF,SAAS,CAAC,CAAC,CAAC,CAACK,SAAS,GAAGL,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC;IAClF,IAAI,CAACf,KAAK,GAAG,CAAC;IACd,IAAI,CAACG,KAAK,GAAGc,IAAI,CAACG,KAAK,CAACjB,KAAK,CAAC;IAC9B,IAAI,CAACC,IAAI,CAACD,KAAK,GAAG,IAAI,CAACA,KAAK;IAC5Bd,EAAE,CAACgC,GAAG,CAACC,WAAW,CAACC,uBAAuB,CAAC,IAAI,CAACtB,EAAE,EAAE,IAAI,CAACE,KAAK,CAAC;IAC/D,IAAI,CAACL,QAAQ,CAAC0B,MAAM,GAAG,IAAI,CAACrB,KAAK,CAACsB,QAAQ,EAAE;IAC5C,IAAIC,KAAK,GAAG,CAAC,CAAC;IACdA,KAAK,CAAC1B,KAAK,GAAG,CAAC,CAAC,CAAC;IACjB0B,KAAK,CAACzB,EAAE,GAAG,IAAI,CAACA,EAAE;IAClByB,KAAK,CAACjB,IAAI,GAAG,IAAI,CAACL,IAAI,CAACK,IAAI;IAC3BiB,KAAK,CAAChB,IAAI,GAAG,IAAI,CAACN,IAAI,CAACM,IAAI;IAC3BgB,KAAK,CAACvB,KAAK,GAAG,IAAI,CAACA,KAAK;IACxB,OAAOuB,KAAK;EAChB,CAAC;EAED;EACAd,YAAY,EAAC,SAAAA,aAAA,EAAU;IACnB,IAAIE,SAAS,GAAG,IAAI,CAACV,IAAI,CAACU,SAAS;IACnC,IAAIX,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ;IACjC,IAAIc,MAAM,GAAG,CAAC;IAEd,IAAIC,IAAI,GAAGb,IAAI,CAACC,MAAM,EAAE;IACxB,IAAGY,IAAI,GAAGhB,SAAS,CAAC,CAAC,CAAC,CAACiB,WAAW,EAClC;MACIF,MAAM,GAAG,CAAC,CAAC,CAAC;MACZ,IAAI,CAAClB,OAAO,GAAG,CAAC;MAChB,IAAIK,CAAC,GAAGC,IAAI,CAACC,MAAM,EAAE;MACrBf,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,GAAGC,CAAC,IAAEF,SAAS,CAAC,CAAC,CAAC,CAACK,SAAS,GAAGL,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC;IACtF,CAAC,MACI,IAAGe,IAAI,IAAIhB,SAAS,CAAC,CAAC,CAAC,CAACiB,WAAW,GAAGjB,SAAS,CAAC,CAAC,CAAC,CAACiB,WAAW,EACnE;MACIF,MAAM,GAAG,CAAC,CAAC,CAAC;MACZ,IAAI,CAAClB,OAAO,GAAG,CAAC;MAChB,IAAIK,CAAC,GAAGC,IAAI,CAACC,MAAM,EAAE;MACrBf,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,GAAGC,CAAC,IAAEF,SAAS,CAAC,CAAC,CAAC,CAACK,SAAS,GAAGL,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC;IACtF,CAAC,MAED;MACIc,MAAM,GAAG,CAAC,CAAC;MACX,IAAI,CAAClB,OAAO,GAAG,CAAC;MAChB,IAAIK,CAAC,GAAGC,IAAI,CAACC,MAAM,EAAE;MACrBf,KAAK,GAAGW,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,GAAGC,CAAC,IAAEF,SAAS,CAAC,CAAC,CAAC,CAACK,SAAS,GAAGL,SAAS,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC;IACtF;IACA,IAAI,CAACf,KAAK,GAAG6B,MAAM;IACnB,IAAI,CAAC1B,KAAK,GAAGc,IAAI,CAACG,KAAK,CAACjB,KAAK,CAAC;IAC9B,IAAI,CAACC,IAAI,CAACD,KAAK,GAAG,IAAI,CAACA,KAAK;IAC5Bd,EAAE,CAACgC,GAAG,CAACC,WAAW,CAACC,uBAAuB,CAAC,IAAI,CAACtB,EAAE,EAAE,IAAI,CAACE,KAAK,CAAC;IAC/D,IAAI,CAACL,QAAQ,CAAC0B,MAAM,GAAG,IAAI,CAACrB,KAAK,CAACsB,QAAQ,EAAE;IAC5C,IAAIC,KAAK,GAAG,CAAC,CAAC;IACdA,KAAK,CAAC1B,KAAK,GAAG6B,MAAM,CAAC,CAAC;IACtBH,KAAK,CAACzB,EAAE,GAAG,IAAI,CAACA,EAAE;IAClByB,KAAK,CAACjB,IAAI,GAAG,IAAI,CAACL,IAAI,CAACK,IAAI;IAC3BiB,KAAK,CAAChB,IAAI,GAAG,IAAI,CAACN,IAAI,CAACM,IAAI;IAC3BgB,KAAK,CAACvB,KAAK,GAAG,IAAI,CAACA,KAAK;IACxB,OAAOuB,KAAK;EAChB,CAAC;EAEDM,eAAe,EAAC,SAAAA,gBAAA,EAAU;IACtB3C,EAAE,CAACgC,GAAG,CAACY,QAAQ,CAACC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAACjC,EAAE,CAAC;IAC3C,IAAGZ,EAAE,CAACgC,GAAG,CAACC,WAAW,CAACa,SAAS,IAAIhD,SAAS,CAACiD,KAAK,EAClD;MACI,IAAIV,KAAK,GAAG,CAAC,CAAC;MACdA,KAAK,CAACW,IAAI,GAAG,iBAAiB;MAC9BhD,EAAE,CAACiD,QAAQ,CAACC,WAAW,CAACC,IAAI,CAACnD,EAAE,CAACgC,GAAG,CAACpC,KAAK,CAACwD,aAAa,EAAEf,KAAK,CAAC;MAC/D;IACJ;IACA;IACArC,EAAE,CAACiD,QAAQ,CAACC,WAAW,CAACC,IAAI,CAACnD,EAAE,CAACgC,GAAG,CAACpC,KAAK,CAACyD,UAAU,EAAE,IAAI,CAACtC,IAAI,CAAC;EACpE;AACJ,CAAC,CAAC;AACFuC,MAAM,CAACC,OAAO,GAAGxD,SAAS","sourceRoot":"/","sourcesContent":["var Event = require(\"Event\");\r\nvar UserState = require(\"UserState\");\r\nvar GoodsItem = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //UI\r\n        Atlas:cc.SpriteAtlas,\r\n        IconSp:cc.Sprite,\r\n        NameLbl:cc.Sprite,\r\n        PriceLbl:cc.Label,\r\n        State:1, //状态\r\n        //Data\r\n        Id:cc.Integer,\r\n        price:cc.Integer,\r\n        Data:null,\r\n    },\r\n    \r\n    init:function (data) {\r\n        this.Data = data;\r\n        this.Id = data.Id;\r\n        this.IconSp.spriteFrame = this.Atlas.getSpriteFrame(data.icon);\r\n        this.NameLbl.spriteFrame = this.Atlas.getSpriteFrame(data.name);\r\n        this.priceId = 0; //所在的价格区间\r\n        this.refreshPrice();\r\n    },\r\n\r\n    refreshLowPrice:function(){\r\n        var priceList = this.Data.priceList;\r\n        var price = priceList[0].lowprice;\r\n        this.priceId = 0;\r\n        var d = Math.random();\r\n        price = priceList[0].lowprice + d*(priceList[0].highprice - priceList[0].lowprice);\r\n        this.price = Math.floor(price);\r\n        this.Data.price = this.price;\r\n        cc.Mgr.UserDataMgr.RefreshGoodsMarKetPrice(this.Id, this.price);\r\n        this.PriceLbl.string = this.price.toString();\r\n        var param = {};\r\n        this.State = 0;\r\n        param.State = 0; //-2表示暴跌 -1表示跌了  0 表示稳定  1有所增长 2表示暴涨\r\n        param.Id = this.Id;\r\n        param.icon = this.Data.icon;\r\n        param.name = this.Data.name;\r\n        param.price = this.price;\r\n        return param;\r\n    },\r\n\r\n    refreshMidPrice:function(){\r\n        var priceList = this.Data.priceList;\r\n        var price = priceList[0].lowprice;\r\n        this.priceId = 1;\r\n        var d = Math.random();\r\n        price = priceList[1].lowprice + d*(priceList[1].highprice - priceList[1].lowprice);\r\n        this.price = Math.floor(price);\r\n        this.Data.price = this.price;\r\n        cc.Mgr.UserDataMgr.RefreshGoodsMarKetPrice(this.Id, this.price);\r\n        this.PriceLbl.string = this.price.toString();\r\n        var param = {};\r\n        this.State = 1;\r\n        param.State = 1; //-2表示暴跌 -1表示跌了  0 表示稳定  1有所增长 2表示暴涨\r\n        param.Id = this.Id;\r\n        param.icon = this.Data.icon;\r\n        param.name = this.Data.name;\r\n        param.price = this.price;\r\n        return param;\r\n    },\r\n\r\n    refreshUpPrice:function(){\r\n        var priceList = this.Data.priceList;\r\n        var price = priceList[0].lowprice;\r\n        /*\r\n        var seed = 0.99999;\r\n        if(seed < priceList[0].probability)\r\n        {\r\n            change = 0; //-this.priceId;\r\n            this.priceId = 0;\r\n            var d = Math.random();\r\n            price = priceList[0].lowprice + d*(priceList[0].highprice - priceList[0].lowprice);\r\n        }\r\n        else if(seed <= priceList[0].probability + priceList[1].probability)\r\n        {\r\n            change = 1; //-this.priceId;\r\n            this.priceId = 1;\r\n            var d = Math.random();\r\n            price = priceList[1].lowprice + d*(priceList[1].highprice - priceList[1].lowprice);\r\n        }\r\n        else\r\n        {\r\n            change = 2;//-this.priceId;\r\n            this.priceId = 2;\r\n            var d = Math.random();\r\n            price = priceList[2].lowprice + (priceList[2].highprice - priceList[2].lowprice);\r\n        }\r\n        */\r\n        this.priceId = 2;\r\n        var d = Math.random();\r\n        price = priceList[2].lowprice + d*(priceList[2].highprice - priceList[2].lowprice);\r\n        this.State = 2;\r\n        this.price = Math.floor(price);\r\n        this.Data.price = this.price;\r\n        cc.Mgr.UserDataMgr.RefreshGoodsMarKetPrice(this.Id, this.price);\r\n        this.PriceLbl.string = this.price.toString();\r\n        var param = {};\r\n        param.State = 2; //-2表示暴跌 -1表示跌了  0 表示稳定  1有所增长 2表示暴涨\r\n        param.Id = this.Id;\r\n        param.icon = this.Data.icon;\r\n        param.name = this.Data.name;\r\n        param.price = this.price;\r\n        return param; \r\n    },\r\n\r\n    //刷新价格信息\r\n    refreshPrice:function(){\r\n        var priceList = this.Data.priceList;\r\n        var price = priceList[0].lowprice;\r\n        var change = 0;\r\n\r\n        var seed = Math.random();\r\n        if(seed < priceList[0].probability)\r\n        {\r\n            change = 0; //-this.priceId;\r\n            this.priceId = 0;\r\n            var d = Math.random();\r\n            price = priceList[0].lowprice + d*(priceList[0].highprice - priceList[0].lowprice);\r\n        }\r\n        else if(seed <= priceList[0].probability + priceList[1].probability)\r\n        {\r\n            change = 1; //-this.priceId;\r\n            this.priceId = 1;\r\n            var d = Math.random();\r\n            price = priceList[1].lowprice + d*(priceList[1].highprice - priceList[1].lowprice);\r\n        }\r\n        else\r\n        {\r\n            change = 2;//-this.priceId;\r\n            this.priceId = 2;\r\n            var d = Math.random();\r\n            price = priceList[2].lowprice + d*(priceList[2].highprice - priceList[2].lowprice);\r\n        }\r\n        this.State = change;\r\n        this.price = Math.floor(price);\r\n        this.Data.price = this.price;\r\n        cc.Mgr.UserDataMgr.RefreshGoodsMarKetPrice(this.Id, this.price);\r\n        this.PriceLbl.string = this.price.toString();\r\n        var param = {};\r\n        param.State = change; //-2表示暴跌 -1表示跌了  0 表示稳定  1有所增长 2表示暴涨\r\n        param.Id = this.Id;\r\n        param.icon = this.Data.icon;\r\n        param.name = this.Data.name;\r\n        param.price = this.price;\r\n        return param; \r\n    },\r\n\r\n    OpenBuyTipPanel:function(){\r\n        cc.Mgr.AudioMgr.playSFX(\"goods_\" + this.Id);\r\n        if(cc.Mgr.UserDataMgr.userState == UserState.NotOK)\r\n        {\r\n            var param = {};\r\n            param.text = \"您还处在恢复阶段，目前不能交易\";\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);\r\n            return;\r\n        }\r\n        //cc.log(\"打开购买窗口 = \" + this.Data.name);\r\n        cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenBuyTip, this.Data);\r\n    },\r\n});\r\nmodule.exports = GoodsItem;\r\n"]}