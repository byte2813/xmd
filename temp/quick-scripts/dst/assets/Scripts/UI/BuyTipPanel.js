
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Scripts/UI/BuyTipPanel.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f35497DZwlEFLxbLaqmINkG', 'BuyTipPanel');
// Scripts/UI/BuyTipPanel.js

"use strict";

var Event = require("Event");
var BuyTipPanel = cc.Class({
  "extends": cc.Component,
  properties: {
    IconSp: cc.Sprite,
    nameSp: cc.Sprite,
    Atlas: cc.SpriteAtlas,
    GoodsName: cc.Label,
    BuyNumLbl: cc.Label,
    Slider: cc.Slider,
    Progress: cc.ProgressBar,
    InPutBox: cc.EditBox,
    DesLbl: cc.Label,
    BuyNum: 0,
    CanBuyNum: 0,
    Data: null
  },
  ShowPanel: function ShowPanel(data) {
    this.Data = null;
    this.CanBuyNum = Math.floor(cc.Mgr.UserDataMgr.Cash / data.price);
    if (this.CanBuyNum > cc.Mgr.UserDataMgr.WareHouseCapcity) {
      this.CanBuyNum = cc.Mgr.UserDataMgr.WareHouseCapcity;
    }
    this.IconSp.spriteFrame = this.Atlas.getSpriteFrame(data.icon);
    this.BuyNum = this.CanBuyNum;
    this.nameSp.spriteFrame = this.Atlas.getSpriteFrame(data.name);
    this.BuyNumLbl.string = this.CanBuyNum;
    this.InPutBox.string = this.CanBuyNum;
    this.DesLbl.string = cc.Mgr.global.FormatNum(this.CanBuyNum * data.price);
    this.Slider.progress = 1;
    this.Progress.progress = 1;
    this.Data = data;
  },
  OnSliderChange: function OnSliderChange() {
    this.BuyNum = Math.floor(this.Slider.progress * this.CanBuyNum);
    this.Progress.progress = this.Slider.progress;
    ////cc.log("+++++++++++++++++++++" + this.price);
    this.BuyNumLbl.string = this.BuyNum;
    this.InPutBox.string = this.BuyNum;
    this.DesLbl.string = cc.Mgr.global.FormatNum(this.BuyNum * this.Data.price);
  },
  OnInputBoxEnd: function OnInputBoxEnd() {
    if (this.InPutBox.string != "") {
      if (Number(this.InPutBox.string) != null) {
        if (Number(this.InPutBox.string) > this.CanBuyNum) {
          this.InPutBox.string = this.CanBuyNum;
          this.BuyNum = this.CanBuyNum;
          this.Progress.progress = 1;
          this.Slider.progress = 1;
        } else {
          this.BuyNum = Number(this.InPutBox.string);
          this.Slider.progress = this.BuyNum / this.CanBuyNum;
          this.Progress.progress = this.Slider.progress;
        }
      }
    } else {
      this.InPutBox.string = "0";
      this.BuyNum = 0;
      this.Progress.progress = 0;
      this.Slider.progress = 0;
    }
    this.DesLbl.string = cc.Mgr.global.FormatNum(this.BuyNum * this.Data.price);
  },
  ClickBuyBtn: function ClickBuyBtn() {
    if (this.BuyNum <= 0) {
      cc.Mgr.AudioMgr.playSFX("click");
      return;
    }

    //判断是否已经买了物种物品
    if (cc.Mgr.UserDataMgr.CheckOwnedGoodsNum() == true) {
      this.DesLbl.string = "只能购买拥有5种物品";
      return;
    }
    if (cc.Mgr.UserDataMgr.WareHouseCapcity < this.BuyNum) {
      var param = {};
      param.forWhat = "";
      param.text = "仓库容量不够";
      cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip, param);
      return;
    }
    cc.Mgr.UserDataMgr.WareHouseCapcity -= this.BuyNum;
    cc.Mgr.UserDataMgr.Cash -= this.Data.price * this.BuyNum;
    var param = {};
    param.Num = this.BuyNum;
    param.price = this.Data.price;
    param.Id = this.Data.Id;
    var data = cc.Mgr.UserDataMgr.BuyGoods(param);
    //通知刷新现金
    cc.director.GlobalEvent.emit(cc.Mgr.Event.BuySuccess, data);
    this.ClosePanel();
    return this.Data.Id;
  },
  ClosePanel: function ClosePanel() {
    cc.Mgr.AudioMgr.playSFX("click");
    this.node.active = false;
  }
});
module.exports = BuyTipPanel;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0c1xcVUlcXEJ1eVRpcFBhbmVsLmpzIl0sIm5hbWVzIjpbIkV2ZW50IiwicmVxdWlyZSIsIkJ1eVRpcFBhbmVsIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJJY29uU3AiLCJTcHJpdGUiLCJuYW1lU3AiLCJBdGxhcyIsIlNwcml0ZUF0bGFzIiwiR29vZHNOYW1lIiwiTGFiZWwiLCJCdXlOdW1MYmwiLCJTbGlkZXIiLCJQcm9ncmVzcyIsIlByb2dyZXNzQmFyIiwiSW5QdXRCb3giLCJFZGl0Qm94IiwiRGVzTGJsIiwiQnV5TnVtIiwiQ2FuQnV5TnVtIiwiRGF0YSIsIlNob3dQYW5lbCIsImRhdGEiLCJNYXRoIiwiZmxvb3IiLCJNZ3IiLCJVc2VyRGF0YU1nciIsIkNhc2giLCJwcmljZSIsIldhcmVIb3VzZUNhcGNpdHkiLCJzcHJpdGVGcmFtZSIsImdldFNwcml0ZUZyYW1lIiwiaWNvbiIsIm5hbWUiLCJzdHJpbmciLCJnbG9iYWwiLCJGb3JtYXROdW0iLCJwcm9ncmVzcyIsIk9uU2xpZGVyQ2hhbmdlIiwiT25JbnB1dEJveEVuZCIsIk51bWJlciIsIkNsaWNrQnV5QnRuIiwiQXVkaW9NZ3IiLCJwbGF5U0ZYIiwiQ2hlY2tPd25lZEdvb2RzTnVtIiwicGFyYW0iLCJmb3JXaGF0IiwidGV4dCIsImRpcmVjdG9yIiwiR2xvYmFsRXZlbnQiLCJlbWl0IiwiT3BlbkNvbW1vblRpcCIsIk51bSIsIklkIiwiQnV5R29vZHMiLCJCdXlTdWNjZXNzIiwiQ2xvc2VQYW5lbCIsIm5vZGUiLCJhY3RpdmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLEtBQUssR0FBR0MsT0FBTyxDQUFDLE9BQU8sQ0FBQztBQUM1QixJQUFJQyxXQUFXLEdBQUdDLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDO0VBQ3ZCLFdBQVNELEVBQUUsQ0FBQ0UsU0FBUztFQUVyQkMsVUFBVSxF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QUNkQSxLQUFLLENBQUNPLEdBQUcsR0FBRyxJQUFJLENBQUNsQyxNQUFNO0lBQ3ZCMkIsS0FBSyxDQUFDakIsS0FBSyxHQUFHLElBQUksQ0FBQ1IsSUFBSSxDQUFDUSxLQUFLO0lBQzdCaUIsS0FBSyxDQUFDUSxFQUFFLEdBQUcsSUFBSSxDQUFDakMsSUFBSSxDQUFDaUMsRUFBRTtJQUN2QixJQUFJL0IsSUFBSSxHQUFHdEIsRUFBRSxDQUFDeUIsR0FBRyxDQUFDQyxXQUFXLENBQUM0QixRQUFRLENBQUNULEtBQUssQ0FBQztJQUM3QztJQUNBN0MsRUFBRSxDQUFDZ0QsUUFBUSxDQUFDQyxXQUFXLENBQUNDLElBQUksQ0FBQ2xELEVBQUUsQ0FBQ3lCLEdBQUcsQ0FBQzVCLEtBQUssQ0FBQzBELFVBQVUsRUFBRWpDLElBQUksQ0FBQztJQUMzRCxJQUFJLENBQUNrQyxVQUFVLEVBQUU7SUFDakIsT0FBTyxJQUFJLENBQUNwQyxJQUFJLENBQUNpQyxFQUFFO0VBQ3ZCLENBQUM7RUFFREcsVUFBVSxFQUFDLFNBQUFBLFdBQUEsRUFBVTtJQUNqQnhELEVBQUUsQ0FBQ3lCLEdBQUcsQ0FBQ2lCLFFBQVEsQ0FBQ0MsT0FBTyxDQUFDLE9BQU8sQ0FBQztJQUNoQyxJQUFJLENBQUNjLElBQUksQ0FBQ0MsTUFBTSxHQUFHLEtBQUs7RUFDNUI7QUFFSixDQUFDLENBQUM7QUFDRkMsTUFBTSxDQUFDQyxPQUFPLEdBQUc3RCxXQUFXIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRXZlbnQgPSByZXF1aXJlKFwiRXZlbnRcIik7XHJcbnZhciBCdXlUaXBQYW5lbCA9IGNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgSWNvblNwOmNjLlNwcml0ZSxcclxuICAgICAgICBuYW1lU3A6Y2MuU3ByaXRlLFxyXG4gICAgICAgIEF0bGFzOmNjLlNwcml0ZUF0bGFzLFxyXG4gICAgICAgIEdvb2RzTmFtZTpjYy5MYWJlbCxcclxuICAgICAgICBCdXlOdW1MYmw6Y2MuTGFiZWwsXHJcbiAgICAgICAgU2xpZGVyOmNjLlNsaWRlcixcclxuICAgICAgICBQcm9ncmVzczpjYy5Qcm9ncmVzc0JhcixcclxuICAgICAgICBJblB1dEJveDpjYy5FZGl0Qm94LFxyXG4gICAgICAgIERlc0xibDpjYy5MYWJlbCxcclxuICAgICAgICBCdXlOdW06MCxcclxuICAgICAgICBDYW5CdXlOdW06MCxcclxuICAgICAgICBEYXRhOm51bGwsXHJcbiAgICB9LFxyXG5cclxuICAgIFNob3dQYW5lbDpmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgIHRoaXMuRGF0YSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5DYW5CdXlOdW0gPSBNYXRoLmZsb29yKCBjYy5NZ3IuVXNlckRhdGFNZ3IuQ2FzaCAvIGRhdGEucHJpY2UpO1xyXG4gICAgICAgIGlmKHRoaXMuQ2FuQnV5TnVtID4gY2MuTWdyLlVzZXJEYXRhTWdyLldhcmVIb3VzZUNhcGNpdHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLkNhbkJ1eU51bSA9IGNjLk1nci5Vc2VyRGF0YU1nci5XYXJlSG91c2VDYXBjaXR5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5JY29uU3Auc3ByaXRlRnJhbWUgPSB0aGlzLkF0bGFzLmdldFNwcml0ZUZyYW1lKGRhdGEuaWNvbik7XHJcbiAgICAgICAgdGhpcy5CdXlOdW0gPSB0aGlzLkNhbkJ1eU51bTtcclxuICAgICAgICB0aGlzLm5hbWVTcC5zcHJpdGVGcmFtZSA9IHRoaXMuQXRsYXMuZ2V0U3ByaXRlRnJhbWUoZGF0YS5uYW1lKTtcclxuICAgICAgICB0aGlzLkJ1eU51bUxibC5zdHJpbmcgPSB0aGlzLkNhbkJ1eU51bTtcclxuICAgICAgICB0aGlzLkluUHV0Qm94LnN0cmluZyA9IHRoaXMuQ2FuQnV5TnVtO1xyXG4gICAgICAgIHRoaXMuRGVzTGJsLnN0cmluZyA9IGNjLk1nci5nbG9iYWwuRm9ybWF0TnVtKHRoaXMuQ2FuQnV5TnVtICogZGF0YS5wcmljZSk7IFxyXG4gICAgICAgIHRoaXMuU2xpZGVyLnByb2dyZXNzID0gMTtcclxuICAgICAgICB0aGlzLlByb2dyZXNzLnByb2dyZXNzID0gMTtcclxuICAgICAgICB0aGlzLkRhdGEgPSBkYXRhO1xyXG4gICAgfSxcclxuXHJcbiAgICBPblNsaWRlckNoYW5nZTpmdW5jdGlvbigpe1xyXG4gICAgICAgIHRoaXMuQnV5TnVtID0gTWF0aC5mbG9vcih0aGlzLlNsaWRlci5wcm9ncmVzcyAqIHRoaXMuQ2FuQnV5TnVtKTtcclxuICAgICAgICB0aGlzLlByb2dyZXNzLnByb2dyZXNzID0gdGhpcy5TbGlkZXIucHJvZ3Jlc3M7XHJcbiAgICAgICAgLy8vL2NjLmxvZyhcIisrKysrKysrKysrKysrKysrKysrK1wiICsgdGhpcy5wcmljZSk7XHJcbiAgICAgICAgdGhpcy5CdXlOdW1MYmwuc3RyaW5nID0gdGhpcy5CdXlOdW07XHJcbiAgICAgICAgdGhpcy5JblB1dEJveC5zdHJpbmcgPSB0aGlzLkJ1eU51bVxyXG4gICAgICAgIHRoaXMuRGVzTGJsLnN0cmluZyA9IGNjLk1nci5nbG9iYWwuRm9ybWF0TnVtKHRoaXMuQnV5TnVtICogdGhpcy5EYXRhLnByaWNlKTtcclxuICAgIH0sXHJcblxyXG4gICAgT25JbnB1dEJveEVuZDpmdW5jdGlvbigpe1xyXG4gICAgXHRpZih0aGlzLkluUHV0Qm94LnN0cmluZyAhPSBcIlwiKVxyXG4gICAgXHR7XHJcbiAgICBcdFx0aWYoTnVtYmVyKHRoaXMuSW5QdXRCb3guc3RyaW5nKSAhPSBudWxsKVxyXG4gICAgXHRcdHtcclxuICAgIFx0XHRcdGlmKE51bWJlcih0aGlzLkluUHV0Qm94LnN0cmluZykgPiB0aGlzLkNhbkJ1eU51bSkgXHJcbiAgICBcdFx0XHR7XHJcbiAgICBcdFx0XHRcdHRoaXMuSW5QdXRCb3guc3RyaW5nID0gdGhpcy5DYW5CdXlOdW07XHJcbiAgICBcdFx0XHRcdHRoaXMuQnV5TnVtID0gdGhpcy5DYW5CdXlOdW07XHJcbiAgICBcdFx0XHRcdHRoaXMuUHJvZ3Jlc3MucHJvZ3Jlc3MgPSAxO1xyXG4gICAgXHRcdFx0XHR0aGlzLlNsaWRlci5wcm9ncmVzcyA9IDE7XHJcbiAgICBcdFx0XHR9XHJcbiAgICBcdFx0XHRlbHNlXHJcbiAgICBcdFx0XHR7XHJcbiAgICBcdFx0XHRcdHRoaXMuQnV5TnVtID0gTnVtYmVyKHRoaXMuSW5QdXRCb3guc3RyaW5nKTtcclxuICAgIFx0XHRcdFx0dGhpcy5TbGlkZXIucHJvZ3Jlc3MgPSAgdGhpcy5CdXlOdW0gLyB0aGlzLkNhbkJ1eU51bTtcclxuICAgIFx0XHRcdFx0dGhpcy5Qcm9ncmVzcy5wcm9ncmVzcyA9IHRoaXMuU2xpZGVyLnByb2dyZXNzO1xyXG4gICAgXHRcdFx0fVxyXG4gICAgXHRcdH1cclxuICAgIFx0fVxyXG4gICAgXHRlbHNlXHJcbiAgICBcdHtcclxuICAgIFx0XHR0aGlzLkluUHV0Qm94LnN0cmluZyA9IFwiMFwiO1xyXG5cdFx0XHR0aGlzLkJ1eU51bSA9IDA7XHJcblx0XHRcdHRoaXMuUHJvZ3Jlc3MucHJvZ3Jlc3MgPSAwO1xyXG5cdFx0XHR0aGlzLlNsaWRlci5wcm9ncmVzcyA9IDA7XHJcbiAgICBcdH1cclxuICAgIFx0dGhpcy5EZXNMYmwuc3RyaW5nID0gY2MuTWdyLmdsb2JhbC5Gb3JtYXROdW0odGhpcy5CdXlOdW0gKiB0aGlzLkRhdGEucHJpY2UpO1xyXG4gICAgfSxcclxuXHJcbiAgICBDbGlja0J1eUJ0bjpmdW5jdGlvbigpe1xyXG4gICAgICAgIGlmKHRoaXMuQnV5TnVtIDw9IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjYy5NZ3IuQXVkaW9NZ3IucGxheVNGWChcImNsaWNrXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+WIpOaWreaYr+WQpuW3sue7j+S5sOS6hueJqeenjeeJqeWTgVxyXG4gICAgICAgIGlmKGNjLk1nci5Vc2VyRGF0YU1nci5DaGVja093bmVkR29vZHNOdW0oKSA9PSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5EZXNMYmwuc3RyaW5nID0gXCLlj6rog73otK3kubDmi6XmnIk156eN54mp5ZOBXCI7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoY2MuTWdyLlVzZXJEYXRhTWdyLldhcmVIb3VzZUNhcGNpdHkgPCB0aGlzLkJ1eU51bSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBwYXJhbSA9IHt9O1xyXG4gICAgICAgICAgICBwYXJhbS5mb3JXaGF0ID0gXCJcIjtcclxuICAgICAgICAgICAgcGFyYW0udGV4dCA9IFwi5LuT5bqT5a656YeP5LiN5aSfXCI7XHJcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLkdsb2JhbEV2ZW50LmVtaXQoY2MuTWdyLkV2ZW50Lk9wZW5Db21tb25UaXAsIHBhcmFtKTtcclxuICAgICAgICAgICAgcmV0dXJuIDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2MuTWdyLlVzZXJEYXRhTWdyLldhcmVIb3VzZUNhcGNpdHkgLT0gdGhpcy5CdXlOdW07XHJcblxyXG4gICAgICAgIGNjLk1nci5Vc2VyRGF0YU1nci5DYXNoIC09ICh0aGlzLkRhdGEucHJpY2UgKiB0aGlzLkJ1eU51bSk7XHJcbiAgICAgICAgdmFyIHBhcmFtID0ge307XHJcbiAgICAgICAgcGFyYW0uTnVtID0gdGhpcy5CdXlOdW07XHJcbiAgICAgICAgcGFyYW0ucHJpY2UgPSB0aGlzLkRhdGEucHJpY2U7XHJcbiAgICAgICAgcGFyYW0uSWQgPSB0aGlzLkRhdGEuSWQ7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBjYy5NZ3IuVXNlckRhdGFNZ3IuQnV5R29vZHMocGFyYW0pO1xyXG4gICAgICAgIC8v6YCa55+l5Yi35paw546w6YeRXHJcbiAgICAgICAgY2MuZGlyZWN0b3IuR2xvYmFsRXZlbnQuZW1pdChjYy5NZ3IuRXZlbnQuQnV5U3VjY2VzcywgZGF0YSk7XHJcbiAgICAgICAgdGhpcy5DbG9zZVBhbmVsKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuRGF0YS5JZDtcclxuICAgIH0sXHJcblxyXG4gICAgQ2xvc2VQYW5lbDpmdW5jdGlvbigpe1xyXG4gICAgICAgIGNjLk1nci5BdWRpb01nci5wbGF5U0ZYKFwiY2xpY2tcIik7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbn0pO1xyXG5tb2R1bGUuZXhwb3J0cyA9IEJ1eVRpcFBhbmVsO1xyXG4iXX0=