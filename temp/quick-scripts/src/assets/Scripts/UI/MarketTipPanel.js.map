{"version":3,"sources":["assets\\Scripts\\UI\\MarketTipPanel.js"],"names":["MarketTipItem","require","MarketTipPanel","cc","Class","Component","properties","TipList","type","DesLbl","Label","IntoNode","Node","IntoDes","IntoDesNull","ClosePanel","Mgr","AudioMgr","playSFX","node","active","UserDataMgr","CanGetStockProfit","global","showStockProfit","bonus","Id","i","CompanyList","length","da","stockNum","Math","floor","stockPrice","bonusRatio","StockAddBonus","param","forWhat","director","GlobalEvent","emit","Event","OpenCommonTip","tutorialStep","tutorialInMarket","dt","step","OpenTutorial","ShowPanel","string","list","CheckShowDes","getTranslation","des","DickDes","State","name","par","SetData","desId","re","checkNum","rem","push","GoodsForeId","Age","seed","random","d","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var MarketTipItem = require(\"MarketTipItem\");\r\nvar MarketTipPanel = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       TipList:{\r\n        default:[],\r\n        type:[MarketTipItem],\r\n       },\r\n       DesLbl:cc.Label,\r\n       IntoNode:cc.Node,\r\n       IntoDes:cc.Label,\r\n       IntoDesNull:cc.Node,\r\n    },\r\n\r\n    ClosePanel:function () {\r\n        cc.Mgr.AudioMgr.playSFX(\"click\");\r\n        this.node.active = false;\r\n\r\n        //弹出计算股票收益\r\n        if(cc.Mgr.UserDataMgr.CanGetStockProfit == true && cc.Mgr.global.showStockProfit == true)\r\n        {\r\n            var bonus = 0;\r\n            var Id = -1;\r\n            for (var i = cc.Mgr.UserDataMgr.CompanyList.length - 1; i >= 0; i--) {\r\n                var da = cc.Mgr.UserDataMgr.CompanyList[i];\r\n                if(da.stockNum > 0)\r\n                { \r\n                    Id = da.Id;\r\n                    bonus += Math.floor(da.stockNum * da.stockPrice * (da.bonusRatio + (cc.Mgr.UserDataMgr.StockAddBonus / 100)));\r\n                }\r\n            }\r\n            var param = {};\r\n            param.forWhat = \"StockBonus\";\r\n            param.bonus = bonus;\r\n            param.Id = Id;\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenCommonTip , param);\r\n            cc.Mgr.global.showStockProfit = false;\r\n        }\r\n        if(cc.Mgr.global.tutorialStep == 11 && cc.Mgr.UserDataMgr.tutorialInMarket == false)  //引导步骤 采用 11 表示第一个大步骤 第一小步\r\n        {\r\n            var dt = {};\r\n            dt.step = 11;\r\n            cc.director.GlobalEvent.emit(cc.Mgr.Event.OpenTutorial, dt);\r\n        }\r\n    },\r\n\r\n    ShowPanel:function(param){\r\n        for (var i = this.TipList.length - 1; i >= 0; i--)\r\n        {\r\n            this.TipList[i].node.active = false;\r\n        }\r\n        this.IntoDes.string = \"\";\r\n        this.IntoDesNull.active = false;\r\n        //-2表示暴跌 -1表示跌了  0 表示稳定  1有所增长 2表示暴涨\r\n        var list = this.CheckShowDes(param);\r\n        if(list.length == 0)\r\n        {\r\n            this.DesLbl.node.active = true;\r\n            this.DesLbl.string = cc.Mgr.global.getTranslation(\"Market_25\");\r\n        }\r\n        else\r\n        {\r\n            this.DesLbl.node.active = false;\r\n            for (var i = 0; i <= list.length - 1; i++)\r\n            {   \r\n                var des = this.DickDes(list[i].State, list[i].name, list[i].Id);\r\n                this.TipList[i].node.active = true;\r\n                var par = {};\r\n                par.des = des;\r\n                par.Id = list[i].Id;\r\n                this.TipList[i].SetData(par);\r\n            }\r\n            \r\n        } \r\n    },\r\n\r\n    DickDes:function(State, name, Id)\r\n    {\r\n        var des = \"\";\r\n        if(State == 0)\r\n        {\r\n            var desId = \"Market_\" + (2*Id -1);\r\n            //des = cc.Mgr.global.getTranslation(desId);\r\n        }\r\n        else if(State == 2)\r\n        {\r\n            var desId = \"Market_\" + (2*Id);\r\n            //des = cc.Mgr.global.getTranslation(desId);;\r\n        }\r\n        var re = {};\r\n        re.State = State;\r\n        re.desId = desId;\r\n        return re;\r\n    },\r\n\r\n    CheckShowDes:function(param){\r\n        var list = [];\r\n        var checkNum = 0;\r\n        var rem =[];\r\n        for (var i = param.length - 1; i >= 0; i--) {\r\n            if(param[i].State != null)\r\n            {\r\n                if(param[i].State != 1)\r\n                {\r\n                    list.push(param[i]);\r\n                    checkNum += 1;\r\n                }\r\n                if(param[i].State != 2 && param[i].Id != 3) //Id 为3 是字画还是黄金来着\r\n                {\r\n                    rem.push(param[i]);\r\n                }\r\n            }      \r\n        }\r\n        cc.Mgr.global.GoodsForeId = -1;\r\n        if(checkNum <= 3 && cc.Mgr.UserDataMgr.Age >= 30 && rem.length > 0)\r\n        {\r\n            var seed = Math.random();\r\n            if (seed < 0.4)\r\n            {\r\n                var d = Math.floor(Math.random() * rem.length);\r\n                cc.Mgr.global.GoodsForeId = rem[d].Id;\r\n                this.IntoDes.string = cc.Mgr.global.getTranslation(\"goods_\"+rem[d].Id) + \"下一年可能出现涨价\" +\"\\n(前瞻有风险,盈亏自负)\";\r\n            }\r\n            else\r\n            {\r\n                this.IntoDesNull.active = true;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.IntoDesNull.active = true;\r\n        }\r\n        return list;\r\n    },\r\n});\r\nmodule.exports = MarketTipPanel;\r\n"]}