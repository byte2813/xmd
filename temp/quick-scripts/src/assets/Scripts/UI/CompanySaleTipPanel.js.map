{"version":3,"sources":["assets\\Scripts\\UI\\CompanySaleTipPanel.js"],"names":["ItemType","require","TempBonus","CompanySaleTipPanel","cc","Class","Component","properties","Atlas","SpriteAtlas","IconSp","Sprite","TitleName","SaleNumLbl","Label","EarnLbl","Slider","InPutBox","EditBox","Progress","ProgressBar","SaleNum","Data","ShowPanel","data","spriteFrame","getSpriteFrame","icon","name","Mgr","UserDataMgr","getDataByItemTypeAndId","Company","Id","marketPrice","stockPrice","cost","stockCost","Math","floor","stockNum","money","global","TempAdsStockBonus","StockBonus","string","FormatNum","progress","OnSliderChange","OnInputBoxEnd","Number","ClickSaleBtn","AudioMgr","playSFX","getMoney","Cash","param","Num","price","SaleStocks","director","GlobalEvent","emit","Event","SaleStockSuccess","ClosePanel","node","active","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var ItemType = require(\"ItemType\");\r\nvar TempBonus = require(\"TempBonus\");\r\nvar CompanySaleTipPanel = cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        Atlas:cc.SpriteAtlas,\r\n        IconSp:cc.Sprite,\r\n        TitleName:cc.Sprite,\r\n        SaleNumLbl:cc.Label,\r\n        EarnLbl:cc.Label,\r\n        Slider:cc.Slider,\r\n        InPutBox:cc.EditBox,\r\n        Progress:cc.ProgressBar,\r\n        SaleNum:0,\r\n        Data:null,\r\n    },\r\n\r\n    ShowPanel:function (data) {\r\n        this.Data = data;\r\n        this.IconSp.spriteFrame = this.Atlas.getSpriteFrame(data.icon);\r\n        this.TitleName.spriteFrame = this.Atlas.getSpriteFrame(data.name);\r\n\r\n        var data = cc.Mgr.UserDataMgr.getDataByItemTypeAndId(ItemType.Company,this.Data.Id);\r\n        var marketPrice = data.stockPrice;\r\n        var cost = data.stockCost;\r\n        this.SaleNum = Math.floor(this.Data.stockNum / 100);\r\n        var money = Math.floor(this.Data.stockNum * (marketPrice - cost));\r\n        if(cc.Mgr.global.TempAdsStockBonus == TempBonus.StockBonus)\r\n        {\r\n            if(money > 0)\r\n                money = Math.floor(money * 1.2); //有之前看过广告\r\n        }\r\n        this.EarnLbl.string = cc.Mgr.global.FormatNum(money);\r\n        this.SaleNumLbl.string = this.SaleNum;\r\n        this.InPutBox.string = this.SaleNum;\r\n        this.Slider.progress = 1;\r\n        this.Progress.progress = 1;\r\n    },\r\n\r\n    OnSliderChange:function(){\r\n        this.SaleNum = Math.floor(this.Slider.progress * (this.Data.stockNum / 100));\r\n        this.Progress.progress = this.Slider.progress;\r\n        var data = cc.Mgr.UserDataMgr.getDataByItemTypeAndId(ItemType.Company,this.Data.Id);\r\n        var marketPrice = data.stockPrice;\r\n        var cost = data.stockCost;\r\n        var money = Math.floor(this.SaleNum * 100 * (marketPrice - cost));\r\n        if(cc.Mgr.global.TempAdsStockBonus == TempBonus.StockBonus)\r\n        {\r\n            if(money > 0)\r\n                money = Math.floor(money *1.2); //有之前看过广告\r\n        }\r\n        this.EarnLbl.string = cc.Mgr.global.FormatNum(money);\r\n        this.SaleNumLbl.string = this.SaleNum;\r\n        this.InPutBox.string = this.SaleNum;\r\n    },\r\n\r\n    OnInputBoxEnd:function(){\r\n        if(this.InPutBox.string != \"\")\r\n        {\r\n            if(Number(this.InPutBox.string) != null)\r\n            {\r\n                if(Number(this.InPutBox.string) > Math.floor(this.Data.stockNum / 100)) \r\n                {\r\n                    this.InPutBox.string = Math.floor(this.Data.stockNum / 100);\r\n                    this.SaleNum = Math.floor(this.Data.stockNum / 100);\r\n                    this.Progress.progress = 1;\r\n                    this.Slider.progress = 1;\r\n                }\r\n                else\r\n                {\r\n                    this.SaleNum = Number(this.InPutBox.string);\r\n                    this.Slider.progress =  Math.floor(this.SaleNum / (this.Data.stockNum / 100));\r\n                    this.Progress.progress = this.Slider.progress;\r\n                }\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.InPutBox.string = \"0\";\r\n            this.SaleNum = 0;\r\n            this.Progress.progress = 0;\r\n            this.Slider.progress = 0;\r\n        }\r\n        var data = cc.Mgr.UserDataMgr.getDataByItemTypeAndId(ItemType.Company,this.Data.Id);\r\n        var marketPrice = data.stockPrice;\r\n        var cost = data.stockCost;\r\n        var money = Math.floor(this.SaleNum * 100 * (marketPrice - cost));\r\n        if(cc.Mgr.global.TempAdsStockBonus == TempBonus.StockBonus)\r\n        {\r\n            if(money > 0)\r\n                money = Math.floor(money *1.2); //有之前看过广告\r\n        }\r\n        this.EarnLbl.string = cc.Mgr.global.FormatNum(money);\r\n    },\r\n\r\n    ClickSaleBtn:function(){\r\n        if(this.SaleNum <= 0)\r\n        {\r\n            cc.Mgr.AudioMgr.playSFX(\"click\");\r\n            return;\r\n        }\r\n        \r\n        var data = cc.Mgr.UserDataMgr.getDataByItemTypeAndId(ItemType.Company,this.Data.Id);\r\n        var marketPrice = data.stockPrice;\r\n        var cost = data.stockCost;\r\n        var getMoney = Math.floor(marketPrice * this.SaleNum * 100);\r\n        if(cc.Mgr.global.TempAdsStockBonus == TempBonus.StockBonus)\r\n        {\r\n            var money = this.SaleNum * (marketPrice - cost);\r\n            if(money > 0)\r\n                getMoney = Math.floor(getMoney *1.2); //有之前看过广告\r\n            //cc.Mgr.global.TempAdsBonus = TempBonus.NULL;\r\n        }\r\n        cc.Mgr.UserDataMgr.Cash += getMoney;\r\n        var param = {};\r\n        param.Num = this.SaleNum * 100;\r\n        param.price = marketPrice;\r\n        param.Id = this.Data.Id;\r\n        var data = cc.Mgr.UserDataMgr.SaleStocks(param);\r\n        //通知刷新\r\n        cc.director.GlobalEvent.emit(cc.Mgr.Event.SaleStockSuccess, data);\r\n        this.ClosePanel();\r\n    },\r\n\r\n    ClosePanel:function(){\r\n        cc.Mgr.AudioMgr.playSFX(\"click\");\r\n        this.node.active = false;\r\n    },\r\n    \r\n});\r\nmodule.exports = CompanySaleTipPanel;"]}