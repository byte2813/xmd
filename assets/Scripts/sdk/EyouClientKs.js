const BASE_URL='https://games.hndibei.com';export default class EyouClientKs{constructor(){console['log']('EyouClientKs\x20实例已创建');let Q=null,e=0x9,I=null,Y=null,U='-1',s='-1',b='4',j=null,E=null,H=null,w=null,X=null,B=null;const o=new Map();let p=null;const m=()=>{return new Promise((q,l)=>{ks['login']({'force':!![],'success':({code:G})=>{G?(console['log']('code:>',G),q(G)):l(new Error('获取code失败'));},'fail':l});});},O=q=>{Q=q;const l=ks['getSystemInfoSync']();b=l['platform']==='android'?'4':l['platform']==='ios'?'5':'6';const G=ks['getLaunchOptionsSync']()['query'];G&&(I=G['channel'],Y=G['sub_channel']);const V={'10913':['unit_id','callback']};if(V['hasOwnProperty'](I)){const [R,z]=V[I];U=G[R],s=G[z];}else I='10906',Y=''+Q+e+I+b+'0';},n=(q,l)=>{q['gameId']=Q,(q['platformId']=e,q['sys']=b),T(q)['then'](G=>{console['log']('拉起支付返参:',res);if(G['payType']==0xc)G['balance']>0x0?u('充值提示','账户余额:'+G['balance']+'元,\x20还需充值:'+G['needPay']+'元',()=>J(G)):J(G,l);else{if(G['payType']==0x2||G['payType']==0xa)customerPullPay(G,l);else{if(G['payType']==0x4)ks['showModal']({'title':'充值提示','content':'即将展示充值二维码,\x20请扫描二维码完成支付','success':function(V){V['confirm']&&ks['previewImage']({'urls':[G['payUrl']]});}});else throw new Error('非法支付类型');}}});},J=(q,l)=>{if(q['needPay']==0x0){M(q,l);return;}let G={};G['success']=R=>{M(q,l);},G['fail']=R=>{u('快手支付失败',R);};const V=ks['getSystemInfoSync']();G['zone_id']='1',G['os']=q['os'],G['currency_type']='CNY',G['buy_quantity']=q['needPay']*q['rate'],G['third_party_trade_no']=q['orderId'],G['sign']=q['sign'],V['platform']==='ios'&&(G['product_type']=0x1),ks['requestGamePayment'](G);},y=BASE_URL+'/market-multi-game-server/kuaiShouClient/pullPay',T=async q=>{const l=0x3;let G=0x0,V=![],R=![];while(G<l&&!V){try{const z=await c(y,q);if(z['code']===CodeStatus['SUCCESS'])return z['data'];else!R&&(u('支付拉起失败',z['message']),R=!![]);}catch(S){!R&&(u('支付拉起失败','网络超时'),R=!![]);}G++;}throw new Error('支付拉起失败');},u=(q,l,G,V)=>{ks['showModal']({'title':q,'content':l,'success':function(R){if(R['confirm']&&G)G();else R['cancel']&&V&&V();}});},x=BASE_URL+'/market-multi-game-server/kuaiShouClient/deduct',M=async(q,l)=>{try{const G={'orderId':q['orderId'],'gameId':Q,'platformId':e,'userId':q['userId']};let V=await c(x,G);V['code']===CodeStatus['SUCCESS']&&l(V);}catch(R){console['error']('[扣款失败]异常:>',R);}},N=BASE_URL+'/market-multi-game-server/kuaiShouClient/adAction',v=(q,l,G)=>{let V={'gameId':Q,'platformId':e,'channelId':I,'subChannelId':Y,'aid':U,'traceId':s,'sys':b,'userId':E,'adType':q,'adUnitId':l,'adActionType':G};c(N,V)['catch'](R=>{console['log']('发送广告行为失败:>',R);});},C=()=>{if(!p)throw new Error('未创建录屏管理器');},c=(q,l)=>{return new Promise((G,V)=>{ks['request']({'url':q,'method':'POST','header':{'Content-Type':'application/json;charset=UTF-8'},'data':JSON['stringify'](l),'fail':V,'success':function(R){G(R['data']);},'complete':function(R){console['log']('---------------------------------请求\x20BEGIN--------------------------------'),console['log']('Url:>',q),console['log']('请求参数:>',l);const z=R&&(R['data']||R['errMsg'])?R['data']||R['errMsg']:'No\x20response\x20data';console['log']('响应:>',z),console['log']('---------------------------------请求\x20END--------------------------------');}});});},P=BASE_URL+'/market-multi-game-server/kuaiShouClient/initGame';this['init']=async(q,l)=>{try{ks['onShareAppMessage'](R=>{return{'templateId':w,'query':'','success':()=>{console['log']('分享成功');},'fail':z=>{console['log']('分享失败',z);}};}),j=await m(),O(q);const G={'code':j,'gameId':Q,'platformId':e,'channelId':I,'subChannelId':Y,'aid':U,'traceId':s,'sys':b},V=await c(P,G);V['code']===CodeStatus['SUCCESS']&&(E=V['data']['userId'],H=V['data']['unionId'],w=V['data']['shareTemplateId'],V['data']=null),l(j);}catch(R){console['error']('[初始化游戏]异常:>',R);}},this['login']=async q=>{q({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':{'code':j}});};const d=BASE_URL+'/market-multi-game-server/kuaiShouClient/uploadRoleInfo';this['uploadRoleInfo']=async(q,l)=>{try{q['gameId']=Q,q['platformId']=e;const G=await c(d,q);l(G);}catch(V){console['error']('上报角色数据异常:>',V);}},this['pay']=async(q,l)=>{try{n(q,l);}catch(G){console['error']('[支付拉起]异常:>',G);}};const t=BASE_URL+'/market-multi-game-server/kuaiShouClient/antidirt';this['antidirt']=async(q,l)=>{try{let G={'gameId':Q,'platformId':e,'contents':q};const V=await c(t,G);l(V);}catch(R){console['error']('[内容安全检测]异常:>',R);}},this['createRewardedVideoAd']=(q,l)=>{let G={'adUnitId':q['adUnitId']};q['multiton']&&(G['multiton']=q['multiton'],G['multitonRewardMsg']=q['multitonRewardMsg'],G['multitonRewardTimes']=q['multitonRewardTimes']),q['progressTip']&&(G['progressTip']=q['progressTip']),B=ks['createRewardedVideoAd'](G),B['onClose'](V=>{V&&V['isEnded']&&(v(AdType['REWARDED_VIDEO_AD'],X,AdActionType['FINISHED']),console['log']('正常播放结束，可以下发游戏奖励')),q['onClose']&&q['onClose'](V),B['destroy']();}),q['onError']&&B['onError'](V=>{q['onError']&&q['onError'](V),B['destroy']();}),X=q['adUnitId'],l({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['showRewardedVideoAd']=()=>{B&&(B['load'](),B['show']()['then'](()=>v(AdType['REWARDED_VIDEO_AD'],X,AdActionType['SHOW']))['catch'](q=>{B['load']()['then'](()=>{B['show']()['then'](()=>v(AdType['REWARDED_VIDEO_AD'],X,AdActionType['SHOW']));})['catch'](l=>console['log']('激励视频\x20广告显示失败'));}));},this['createGameRecorder']=(q,l)=>{p=ks['getGameRecorder'](),q['onStart']&&p['on']('start',q['onStart']),q['onResume']&&p['on']('resume',q['onResume']),q['onPause']&&p['on']('pause',q['onPause']),q['onStop']&&p['on']('stop',q['onStop']),q['onError']&&p['on']('error',q['onError']),q['onAbort']&&p['on']('abort',q['onAbort']),l({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['gameRecorderStart']=q=>{C(),p['start'](q);},this['gameRecorderPause']=()=>{C(),p['pause']();},this['gameRecorderResume']=()=>{C(),p['resume']();},this['gameRecorderStop']=()=>{C(),console['log']('触发停止录屏'),p['stop']();},this['publishVideo']=q=>{C(),p['publishVideo']({'video':q['videoID'],'callback':l=>{if(l!=null&&l!=undefined){console['log']('分享录屏失败:\x20',l);return;}console['log']('分享录屏成功');}});},this['shareAppMessage']=(q,l)=>{ks['shareAppMessage']({...q,'templateId':w,'success':()=>{l({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},'fail':G=>{console['log']('[分享失败]:>',G),l({'code':CodeStatus['FAIL'],'message':'操作失败','data':null});}});},this['addShortcut']=q=>{ks['addShortcut']({'complete':q});},this['checkShortcut']=q=>{ks['checkShortcut']({'complete':q});},this['addCommonUse']=q=>{ks['addCommonUse']({'complete':q});},this['checkCommonUse']=q=>{ks['checkCommonUse']({'complete':q});};}static['getIns'](){return!this['ins']&&(console['log']('初始化'),this['ins']=new EyouClientKs()),this['ins'];}}class CodeStatus{static ['SUCCESS']=0x0;static ['FAIL']=-0x1;}class AdType{static ['REWARDED_VIDEO_AD']=0x1;static ['BANNER_AD']=0x2;}class AdActionType{static ['SHOW']=0x1;static ['FINISHED']=0x2;}