const BASE_URL='https://games.hndibei.com';export default class EyouClientV2{constructor(){let N=null,h=0x1,E=null,i=null,b='-1',g='-1',B=0x4,n=null,D=null,R=null,x=null,P=null,K=null,y=null;const f=Z=>{N=Z;const l=wx['getSystemInfoSync']();B=l['platform']==='android'?'4':l['platform']==='ios'?'5':'6';const a=wx['getLaunchOptionsSync']()['query'];E=a['channel'],i=a['sub_channel'];const O={'10908':['ad_id','clue_token'],'10918':['ad_id','clue_token'],'10912':['weixinadinfo'],'10913':['ksUnitId','callback'],'10914':['uid','bd_vid'],'10916':['aid','trackid'],'10917':['campaignid','uctrackid'],'10919':['promotion_id','clue_token'],'10920':['ADID','imp','mark_id']};if(O['hasOwnProperty'](E)){const [j,I,Q]=O[E];if(j==='weixinadinfo'){const s=a['weixinadinfo'];if(s){const p=s['split']('.');b=p[0x0],g=p[0x1];}}else b=a[j],g=a[I],!g&&Q&&(g=a[Q]);}else E='10906',i=''+N+h+E+B+'0';},c=()=>{return new Promise((Z,l)=>{wx['login']({'success':({code:a})=>{a?Z(a):l(new Error('获取code失败'));},'fail':l});});},C=(Z,l)=>{return new Promise((a,O)=>{wx['request']({'url':Z,'method':'POST','header':{'Content-Type':'application/json'},'data':JSON['stringify'](l),'fail':O,'success':function(j){a(j['data']);},'complete':function(j){console['log']('---------------------------------请求\x20BEGIN--------------------------------'),console['log']('Url:>',Z),console['log']('请求参数:>',l),console['log']('响应:>',j['data']||j['errMsg']),console['log']('---------------------------------请求\x20END--------------------------------');}});});},t=BASE_URL+'/market-wechat-game-server/wxTransfer/showTransfer',L=async Z=>{try{const l={'gameId':N,'platformId':h,'transferNodeType':Z,'userId':D,'sys':B},a=await C(t,l);if(a['code']===CodeStatus['SUCCESS']){const {transferType:O,showText:j,copyText:I,pictureUrl:Q,showTip:s}=a['data'];if(O===0x1)wx['showModal']({'title':'公告','content':j,'confirmText':'复制链接','success':function(p){p['confirm']&&wx['setClipboardData']({'data':I});}});else{if(O===0x2)wx['previewImage']({'urls':[Q+'?time='+Math['floor'](Date['now']()/0x3e8)]});else O===0x3&&s('公告',s);}}else console['log']('公告展示失败:',a['message']);return{'success':!![],'result':a};}catch(p){return console['error']('[展示公告]异常:',p),{'success':![],'error':error};}},m=(Z,l)=>{Z['gameId']=N,(Z['platformId']=h,Z['sys']=B),Y(Z)['then'](a=>{if(a['payType']==0x1)a['balance']>0x0?A('充值提示','账户余额:'+a['balance']+'元,\x20还需充值:'+a['needPay']+'元',()=>M(a)):M(a,l);else{if(a['payType']==0x2)q(a,l);else{if(a['payType']==0x4)wx['showModal']({'title':'充值提示','content':'即将展示充值二维码,\x20请扫描二维码完成支付','success':function(O){O['confirm']&&wx['previewImage']({'urls':[a['payUrl']]});}});else throw new Error('非法支付类型');}}});},M=(Z,l)=>{if(Z['needPay']==0x0){k(Z,l);return;}wx['requestMidasPayment']({'mode':'game','env':0x0,'offerId':Z['offerId'],'currencyType':'CNY','platform':'android','buyQuantity':Z['needPay']*Z['midasRate'],'zoneId':'1','success':a=>{k(Z,l);},'fail':a=>{A('微信支付失败',a);}});},q=(Z,l)=>{wx['openCustomerServiceConversation']({'showMessageCard':!![],'sessionFrom':Z['payUrl'],'sendMessagePath':'/index.wxml?url='+Z['payUrl'],'sendMessageTitle':'发送卡片充值','sendMessageImg':Z['payIconUrl']});},X=BASE_URL+'/market-wechat-game-server/wxClient/deduct',k=async(Z,l)=>{const a={'orderId':Z['orderId'],'gameId':N,'platformId':h,'userId':Z['userId']},O=0x3;let j=0x0,I=![],Q;while(j<O&&!I){try{Q=await C(X,a);Q['code']===CodeStatus['GAME_SESSION_KEY_TIME_OUT_ERR']&&await v();if(Q['code']===CodeStatus['SUCCESS']){l(Q);break;}}catch(s){console['error']('[扣款失败]异常:>',s);}j++;}},W=BASE_URL+'/market-wechat-game-server/wxClient/pullPay',Y=async Z=>{const l=0x3;let a=0x0,O=![],j=![];while(a<l&&!O){try{const I=await C(W,Z);if(I['code']===CodeStatus['SUCCESS'])return I['data'];else I['code']===CodeStatus['GAME_SESSION_KEY_TIME_OUT_ERR']?await v():!j&&(A('支付拉起失败',I['message']),j=!![]);}catch(Q){!j&&(A('支付拉起失败','网络超时'),j=!![]);}a++;}throw new Error('支付拉起失败');},u=BASE_URL+'/market-wechat-game-server/wxClient/refreshSession',v=async()=>{const Z=0x3;let l=0x0,a=![];while(l<Z&&!a){try{const O=await c(),j={'gameId':N,'platformId':h,'code':O},I=await C(u,j);a=I['code']===CodeStatus['SUCCESS'];}catch(Q){console['error']('[刷新会话失败]异常:>',Q),l++;}}if(!a)throw new Error('刷新会话失败');},J=BASE_URL+'/market-wechat-game-server/wxClient/adAction',A=(Z,l,a,O)=>{wx['showModal']({'title':Z,'content':l,'success':function(j){if(j['confirm']&&a)a();else j['cancel']&&O&&O();}});},H=(Z,l,a)=>{let O={'gameId':N,'platformId':h,'channelId':E,'subChannelId':i,'aid':b,'traceId':g,'sys':B,'userId':D,'adType':Z,'adUnitId':l,'adActionType':a};C(J,O)['catch'](j=>{console['log']('发送广告行为失败:>',j);});},U=BASE_URL+'/market-wechat-game-server/wxClient/initGame';this['init']=async(Z,l)=>{try{f(Z);const a=await c(),O={'code':a,'gameId':N,'platformId':h,'channelId':E,'subChannelId':i,'aid':b,'traceId':g,'sys':B},j=await C(U,O);j['code']===CodeStatus['SUCCESS']&&(D=j['data']['userId'],console['log'](D),R=j['data']['unionId'],n=a,j['data']=null),l(j);}catch(I){console['error']('[初始化游戏]异常:>',I);}},this['login']=async Z=>{try{const l=await L(0x1);(!l['success']||l['result']['code']!=0x0||l['result']['data']['transferType']!=0x3)&&Z({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':{'code':n}});}catch(a){console['error']('[登录游戏]异常:>',a);}},this['pay']=async(Z,l)=>{try{const a=await L(0x2);(!a['success']||a['result']['code']!=0x0)&&m(Z,l);}catch(O){console['error']('[支付拉起]异常:>',O);}};const d=BASE_URL+'/market-wechat-game-server/wxClient/uploadRoleInfo';this['uploadRoleInfo']=async(Z,l)=>{try{Z['gameId']=N,Z['platformId']=h;const a=await C(d,Z);l(a);}catch(O){console['error']('上报角色数据异常:>',O);}};const V=BASE_URL+'/market-wechat-game-server/wxServer/msgSecCheck';this['msgSecCheck']=async(Z,l)=>{Z['gameId']=N,Z['platformId']=h;try{const a=await C(V,Z);l(a);}catch(O){console['error']('[文本安全检测]异常:>',O);}},this['createRewardedVideoAd']=(Z,l)=>{if(!wx['createRewardedVideoAd']){A('提示','基础库版本号过低,\x20暂不支持展示激励视频');return;}if(x!=Z['adUnitId']){if(P){P['destory'](),x=null,P=null,createRewardedVideoAd(Z,l);return;}let a={'adUnitId':Z['adUnitId']};Z['multiton']&&(a['multiton']=Z['multiton']),P=wx['createRewardedVideoAd'](a),P['onError'](O=>console['log']('激励视频程序出错:>',O)),P['onClose'](O=>{O&&O['isEnded']||O===undefined?(H(AdType['REWARDED_VIDEO_AD'],x,AdActionType['FINISHED']),Z['onClose']&&Z['onClose']({'code':CodeStatus['SUCCESS'],'message':'播放完成','data':null})):Z['onClose']&&Z['onClose']({'code':CodeStatus['FAILED'],'message':'播放未完成','data':null});}),x=Z['adUnitId'];}l({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['showRewardedVideoAd']=()=>{P&&P['show']()['then'](()=>H(AdType['REWARDED_VIDEO_AD'],x,AdActionType['SHOW']))['catch'](()=>{P['load']()['then'](()=>P['show']()['then'](()=>H(AdType['REWARDED_VIDEO_AD'],x,AdActionType['SHOW'])))['catch'](Z=>console['log']('激励视频\x20广告显示失败'));});},this['createBannerAd']=(Z,l)=>{if(!wx['createBannerAd']){A('提示','基础库版本号过低,\x20暂不支持展示Banner广告');return;}if(K!=Z['adUnitId']){if(y){y['destory'](),K=null,y=null,createBannerAd(Z,l);return;}let a={'adUnitId':Z['adUnitId'],'style':Z['style']};Z['adIntervals']&&(a['adIntervals']=Z['adIntervals']),y=wx['createBannerAd'](a),y['onLoad'](()=>{H(AdType['BANNER_AD'],K,AdActionType['FINISHED']);}),y['onError'](O=>console['log']('banner广告程序出错:>',O)),K=Z['adUnitId'];}l({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['showBannerAd']=()=>{y&&y['show']();},this['hideBannerAd']=()=>{y&&y['hide']();},this['setStorageSync']=(Z,l)=>{wx['setStorageSync'](Z,l);},this['removeStorageSync']=Z=>{wx['removeStorageSync'](Z);},this['getStorageSync']=Z=>{return wx['getStorageSync'](Z);};}static['getIns'](){return!this['ins']&&(this['ins']=new EyouClientV2()),this['ins'];}}class CodeStatus{static ['SUCCESS']=0x0;static ['FAILED']=-0x1;static ['GAME_SESSION_KEY_TIME_OUT_ERR']=0x2729;}class AdType{static ['REWARDED_VIDEO_AD']=0x1;static ['BANNER_AD']=0x2;}class AdActionType{static ['SHOW']=0x1;static ['FINISHED']=0x2;}